<!DOCTYPE html>
<html lang="hr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>üë∂ NORI APP</title>
  <style>
    :root {
      --color-white: rgba(255, 255, 255, 1);
      --color-cream-50: rgba(252, 252, 249, 1);
      --color-cream-100: rgba(255, 255, 253, 1);
      --color-gray-200: rgba(245, 245, 245, 1);
      --color-gray-300: rgba(167, 169, 169, 1);
      --color-slate-500: rgba(98, 108, 113, 1);
      --color-brown-600: rgba(94, 82, 64, 1);
      --color-charcoal-700: rgba(31, 33, 33, 1);
      --color-charcoal-800: rgba(38, 40, 40, 1);
      --color-teal-500: rgba(33, 128, 141, 1);
      --color-teal-600: rgba(29, 116, 128, 1);
      --color-teal-700: rgba(26, 104, 115, 1);
      --color-pink-400: rgba(236, 72, 153, 1);
      --color-pink-500: rgba(219, 39, 119, 1);
      --color-purple-400: rgba(192, 132, 252, 1);
      --color-purple-500: rgba(168, 85, 247, 1);
      --color-blue-400: rgba(96, 165, 250, 1);
      --color-blue-500: rgba(59, 130, 246, 1);
      --color-orange-400: rgba(251, 146, 60, 1);
      --color-orange-500: rgba(249, 115, 22, 1);
      --color-green-400: rgba(74, 222, 128, 1);
      --color-green-500: rgba(34, 197, 94, 1);

      --color-brown-600-rgb: 94, 82, 64;
      --color-teal-500-rgb: 33, 128, 141;

      --color-background: var(--color-cream-50);
      --color-surface: var(--color-cream-100);
      --color-text: var(--color-charcoal-700);
      --color-text-secondary: var(--color-slate-500);
      --color-primary: var(--color-teal-500);
      --color-primary-hover: var(--color-teal-600);
      --color-border: rgba(var(--color-brown-600-rgb), 0.2);

      --space-8: 8px;
      --space-12: 12px;
      --space-16: 16px;
      --space-20: 20px;
      --space-24: 24px;
      --radius-base: 8px;
      --radius-lg: 12px;
      --radius-full: 9999px;
      --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.08);
      --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --color-gray-400-rgb: 119, 124, 124;
        --color-background: var(--color-charcoal-700);
        --color-surface: var(--color-charcoal-800);
        --color-text: var(--color-gray-200);
        --color-text-secondary: rgba(167, 169, 169, 0.7);
        --color-border: rgba(var(--color-gray-400-rgb), 0.3);
      }
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: var(--color-background);
      color: var(--color-text);
      padding-bottom: 80px;
      overflow-x: hidden;
    }

    .header {
      background: var(--color-surface);
      padding: var(--space-16) var(--space-20);
      box-shadow: var(--shadow-sm);
      position: sticky;
      top: 0;
      z-index: 100;
      border-bottom: 1px solid var(--color-border);
    }

    .header h1 {
      font-size: 24px;
      font-weight: 600;
      color: var(--color-primary);
      margin-bottom: var(--space-8);
    }

    .header-stats {
      display: flex;
      gap: var(--space-16);
      font-size: 12px;
      color: var(--color-text-secondary);
      flex-wrap: wrap;
    }

    .quick-actions {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: var(--space-12);
      padding: var(--space-16);
    }

    .quick-btn {
      background: var(--color-surface);
      border: 2px solid var(--color-border);
      border-radius: var(--radius-lg);
      padding: var(--space-20);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: var(--space-8);
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: var(--shadow-sm);
      user-select: none;
    }

    .quick-btn:active { transform: scale(0.97); box-shadow: none; }

    .quick-btn-icon { font-size: 32px; line-height: 1; }
    .quick-btn-label { font-size: 13px; font-weight: 500; text-align: center; }
    .quick-btn-time { font-size: 11px; color: var(--color-text-secondary); text-align: center; }

    .sleep { border-color: var(--color-purple-400); color: var(--color-purple-500); }
    .feeding { border-color: var(--color-pink-400); color: var(--color-pink-500); }
    .diaper { border-color: var(--color-blue-400); color: var(--color-blue-500); }
    .bath { border-color: var(--color-teal-500); color: var(--color-teal-600); }
    .medicine { border-color: var(--color-orange-400); color: var(--color-orange-500); }
    .checkup { border-color: var(--color-green-400); color: var(--color-green-500); }

    .section {
      background: var(--color-surface);
      margin: var(--space-16);
      padding: var(--space-16);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--color-border);
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--space-16);
    }

    .section-title { font-size: 18px; font-weight: 600; }
    .view-all { font-size: 13px; color: var(--color-primary); cursor: pointer; text-decoration: none; }

    .activity-list { display: flex; flex-direction: column; gap: var(--space-12); }

    .activity-item {
      display: flex;
      gap: var(--space-12);
      padding: var(--space-12);
      background: var(--color-background);
      border-radius: var(--radius-base);
      border: 1px solid var(--color-border);
      align-items: flex-start;
    }

    .activity-icon {
      font-size: 24px;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: var(--radius-base);
      flex-shrink: 0;
    }

    .activity-content { flex: 1; }
    .activity-title { font-weight: 500; font-size: 14px; margin-bottom: 4px; }
    .activity-details { font-size: 12px; color: var(--color-text-secondary); line-height: 1.35; }
    .activity-time { font-size: 12px; color: var(--color-text-secondary); white-space: nowrap; margin-left: 6px; }

    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      animation: fadeIn 0.2s;
    }
    .modal.active { display: flex; align-items: flex-end; }

    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

    .modal-content {
      background: var(--color-surface);
      width: 100%;
      max-height: 85vh;
      border-radius: var(--radius-lg) var(--radius-lg) 0 0;
      padding: var(--space-24);
      animation: slideUp 0.3s ease-out;
      overflow-y: auto;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--space-24);
    }

    .modal-title { font-size: 20px; font-weight: 600; }
    .close-btn { font-size: 28px; cursor: pointer; color: var(--color-text-secondary); line-height: 1; }

    .form-group { margin-bottom: var(--space-20); }
    .form-label { display: block; font-size: 14px; font-weight: 500; margin-bottom: var(--space-8); }

    .form-input, .form-select, .form-textarea {
      width: 100%;
      padding: var(--space-12);
      border: 2px solid var(--color-border);
      border-radius: var(--radius-base);
      font-size: 15px;
      background: var(--color-background);
      color: var(--color-text);
    }
    .form-textarea { min-height: 80px; resize: vertical; font-family: inherit; }

    .form-input:focus, .form-select:focus, .form-textarea:focus {
      outline: none;
      border-color: var(--color-primary);
    }

    .button-group { display: flex; gap: var(--space-12); margin-bottom: var(--space-20); flex-wrap: wrap; }

    .toggle-btn {
      flex: 1;
      min-width: 110px;
      padding: var(--space-12);
      border: 2px solid var(--color-border);
      border-radius: var(--radius-base);
      background: var(--color-background);
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.2s;
    }

    .toggle-btn.active {
      background: var(--color-primary);
      color: white;
      border-color: var(--color-primary);
    }

    .submit-btn {
      width: 100%;
      padding: var(--space-16);
      background: var(--color-primary);
      color: white;
      border: none;
      border-radius: var(--radius-base);
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .submit-btn:active { transform: scale(0.98); background: var(--color-primary-hover); }

    .timer-display {
      text-align: center;
      padding: var(--space-24);
      background: var(--color-background);
      border-radius: var(--radius-lg);
      margin-bottom: var(--space-20);
      border: 1px solid var(--color-border);
    }

    .timer-text {
      font-size: 48px;
      font-weight: 700;
      color: var(--color-primary);
      font-variant-numeric: tabular-nums;
    }

    .timer-label { font-size: 14px; color: var(--color-text-secondary); margin-top: var(--space-8); }

    .bottom-nav {
      position: fixed;
      bottom: 0; left: 0; right: 0;
      background: var(--color-surface);
      border-top: 1px solid var(--color-border);
      display: flex;
      justify-content: space-around;
      padding: var(--space-12) 0;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
      z-index: 200;
    }

    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      cursor: pointer;
      color: var(--color-text-secondary);
      transition: color 0.2s;
      padding: var(--space-8);
      position: relative;
      user-select: none;
    }

    .nav-item.active { color: var(--color-primary); }
    .nav-icon { font-size: 24px; }
    .nav-label { font-size: 11px; }

    .empty-state { text-align: center; padding: var(--space-24); color: var(--color-text-secondary); font-size: 14px; }

    .stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--space-12); }

    .stat-card {
      background: var(--color-background);
      padding: var(--space-16);
      border-radius: var(--radius-base);
      border: 1px solid var(--color-border);
    }

    .stat-value { font-size: 24px; font-weight: 700; color: var(--color-primary); margin-bottom: 4px; }
    .stat-label { font-size: 12px; color: var(--color-text-secondary); }

    .notification-badge {
      position: absolute;
      top: 4px;
      right: 18px;
      background: var(--color-orange-500);
      color: white;
      border-radius: var(--radius-full);
      min-width: 18px;
      height: 18px;
      padding: 0 6px;
      font-size: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      line-height: 1;
    }

    .reminders-list { display: flex; flex-direction: column; gap: var(--space-12); }

    .reminder-item {
      background: rgba(var(--color-teal-500-rgb), 0.08);
      border: 1px solid var(--color-primary);
      border-radius: var(--radius-base);
      padding: var(--space-12);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: var(--space-12);
    }

    .reminder-content { flex: 1; }
    .reminder-title { font-weight: 500; font-size: 14px; margin-bottom: 4px; }
    .reminder-time { font-size: 12px; color: var(--color-text-secondary); line-height: 1.35; }
    .delete-btn { color: var(--color-orange-500); font-size: 20px; cursor: pointer; padding: var(--space-8); user-select: none; }

    .page { display: none; }
    .page.active { display: block; }
  </style>
</head>
<body>
  <!-- Poƒçetna stranica -->
  <div id="homePage" class="page active">
    <div class="header">
      <h1>üë∂ Baby Tracker</h1>
      <div class="header-stats">
        <span>üåô Posljednji san: <strong id="lastSleepTime">-</strong></span>
        <span>üçº Posljednje hranjenje: <strong id="lastFeedingTime">-</strong></span>
      </div>
    </div>

    <div class="quick-actions">
      <div class="quick-btn sleep" onclick="openModal('sleep')">
        <div class="quick-btn-icon">üò¥</div>
        <div class="quick-btn-label">San</div>
        <div class="quick-btn-time" id="sleepLastTime">-</div>
      </div>
      <div class="quick-btn feeding" onclick="openModal('feeding')">
        <div class="quick-btn-icon">üçº</div>
        <div class="quick-btn-label">Hranjenje</div>
        <div class="quick-btn-time" id="feedingLastTime">-</div>
      </div>
      <div class="quick-btn diaper" onclick="openModal('diaper')">
        <div class="quick-btn-icon">üë∂</div>
        <div class="quick-btn-label">Pelena</div>
        <div class="quick-btn-time" id="diaperLastTime">-</div>
      </div>
      <div class="quick-btn bath" onclick="openModal('bath')">
        <div class="quick-btn-icon">üõÅ</div>
        <div class="quick-btn-label">Kupanje</div>
        <div class="quick-btn-time" id="bathLastTime">-</div>
      </div>
      <div class="quick-btn medicine" onclick="openModal('medicine')">
        <div class="quick-btn-icon">üíä</div>
        <div class="quick-btn-label">Lijekovi</div>
        <div class="quick-btn-time" id="medicineLastTime">-</div>
      </div>
      <div class="quick-btn" onclick="openModal('colic')">
        <div class="quick-btn-icon">üò£</div>
        <div class="quick-btn-label">Grƒçevi</div>
        <div class="quick-btn-time" id="colicLastTime">-</div>
      </div>
    </div>

    <div class="section">
      <div class="section-header">
        <h2 class="section-title">Najnovije aktivnosti</h2>
        <a class="view-all" onclick="switchPage('history')">Prika≈æi sve</a>
      </div>
      <div id="recentActivities" class="activity-list"></div>
    </div>

    <div class="section">
      <div class="section-header">
        <h2 class="section-title">Dnevna statistika</h2>
      </div>
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-value" id="todaySleepCount">0</div>
          <div class="stat-label">Spavanja</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="todayFeedingCount">0</div>
          <div class="stat-label">Hranjenja</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="todayDiaperCount">0</div>
          <div class="stat-label">Pelene</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="todayTotalSleep">0h</div>
          <div class="stat-label">Ukupno spavanja</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Stranica historije -->
  <div id="historyPage" class="page">
    <div class="header">
      <h1>üìä Historija</h1>
    </div>
    <div class="section">
      <div id="allActivities" class="activity-list"></div>
    </div>
  </div>

  <!-- Stranica kontrola -->
  <div id="checkupPage" class="page">
    <div class="header">
      <h1>üè• Kontrole</h1>
    </div>
    <div class="section">
      <button class="submit-btn" onclick="openModal('checkup')">+ Dodaj kontrolu</button>
      <div style="height: 16px;"></div>
      <div id="checkupList" class="activity-list"></div>
    </div>
  </div>

  <!-- Stranica podsjetnika -->
  <div id="remindersPage" class="page">
    <div class="header">
      <h1>üîî Podsjetnici</h1>
    </div>
    <div class="section">
      <button class="submit-btn" onclick="openModal('reminder')">+ Dodaj podsjetnik</button>
      <div style="height: 16px;"></div>
      <div id="remindersList" class="reminders-list"></div>
    </div>
  </div>

  <!-- Modal za san -->
  <div id="sleepModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">üò¥ San</h2>
        <span class="close-btn" onclick="closeModal('sleep')">&times;</span>
      </div>

      <div id="sleepTimer" class="timer-display" style="display:none;">
        <div class="timer-text" id="sleepTimerText">00:00:00</div>
        <div class="timer-label" id="sleepTimerLabel">Vrijeme spavanja</div>
      </div>

      <div class="form-group" id="sleepStartGroup">
        <label class="form-label">Poƒçetak spavanja</label>
        <input type="datetime-local" id="sleepStartTime" class="form-input">
      </div>

      <div class="form-group" id="sleepEndGroup" style="display:none;">
        <label class="form-label">Buƒëenje</label>
        <input type="datetime-local" id="sleepEndTime" class="form-input">
      </div>

      <div class="form-group">
        <label class="form-label">Bilje≈°ke</label>
        <textarea id="sleepNotes" class="form-textarea" placeholder="Dodatne bilje≈°ke..."></textarea>
      </div>

      <button class="submit-btn" id="sleepStartBtn" onclick="startSleep()" style="background: var(--color-purple-500);">üõèÔ∏è Dijete zaspalo</button>
      <button class="submit-btn" id="sleepWakeBtn" onclick="wakeSleep()" style="display:none; background: var(--color-orange-500);">‚òÄÔ∏è Dijete se probudilo</button>
    </div>
  </div>

  <!-- Modal za hranjenje -->
  <div id="feedingModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">üçº Hranjenje</h2>
        <span class="close-btn" onclick="closeModal('feeding')">&times;</span>
      </div>

      <div id="feedingInfo" class="timer-display" style="display:none;">
        <div class="timer-label" id="feedingInfoLabel">-</div>
      </div>

      <div class="form-group" id="feedingStartGroup">
        <label class="form-label">Poƒçetak hranjenja</label>
        <input type="datetime-local" id="feedingStartTime" class="form-input">
      </div>

      <div class="form-group" id="feedingEndGroup" style="display:none;">
        <label class="form-label">Kraj hranjenja</label>
        <input type="datetime-local" id="feedingEndTime" class="form-input">
      </div>

      <div class="form-group">
        <label class="form-label">Dojka</label>
        <div class="button-group" id="breastButtons">
          <button class="toggle-btn" data-value="left" onclick="selectBreast(this)">Lijeva</button>
          <button class="toggle-btn" data-value="right" onclick="selectBreast(this)">Desna</button>
          <button class="toggle-btn" data-value="both" onclick="selectBreast(this)">Obje</button>
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">Bilje≈°ke (opciono)</label>
        <textarea id="feedingNotes" class="form-textarea" placeholder="Dodatne bilje≈°ke..."></textarea>
      </div>

      <div class="form-group">
        <label class="form-label">
          <input type="checkbox" id="feedingReminderCheck" style="margin-right: 8px;">
          Postavi podsjetnik za sljedeƒáe hranjenje
        </label>
      </div>

      <div class="form-group" id="feedingReminderGroup" style="display:none;">
        <label class="form-label">Za koliko sati?</label>
        <div class="button-group">
          <button type="button" class="toggle-btn" data-value="1.5" onclick="selectFeedingReminderHours(this)">1.5h</button>
          <button type="button" class="toggle-btn" data-value="2" onclick="selectFeedingReminderHours(this)">2h</button>
          <button type="button" class="toggle-btn" data-value="2.5" onclick="selectFeedingReminderHours(this)">2.5h</button>
          <button type="button" class="toggle-btn" data-value="3" onclick="selectFeedingReminderHours(this)">3h</button>
        </div>
      </div>

      <button class="submit-btn" id="feedingStartBtn" onclick="startFeeding()" style="background: var(--color-pink-500);">üçº Poƒçinje jesti</button>
      <button class="submit-btn" id="feedingEndBtn" onclick="endFeeding()" style="display:none; background: var(--color-green-500);">‚úì Zavr≈°io jesti</button>
    </div>
  </div>

  <!-- Modal za pelenu -->
  <div id="diaperModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">üë∂ Pelena</h2>
        <span class="close-btn" onclick="closeModal('diaper')">&times;</span>
      </div>

      <div class="form-group">
        <label class="form-label">Vrijeme</label>
        <input type="datetime-local" id="diaperTime" class="form-input">
      </div>

      <div class="form-group">
        <label class="form-label">Tip</label>
        <div class="button-group" id="diaperButtons">
          <button class="toggle-btn" data-value="wet" onclick="selectDiaperType(this)">üíß Mokra</button>
          <button class="toggle-btn" data-value="dirty" onclick="selectDiaperType(this)">üí© Prljava</button>
          <button class="toggle-btn" data-value="both" onclick="selectDiaperType(this)">Oboje</button>
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">Bilje≈°ke</label>
        <textarea id="diaperNotes" class="form-textarea" placeholder="Dodatne bilje≈°ke..."></textarea>
      </div>

      <button class="submit-btn" onclick="saveDiaper()">Spremi</button>
    </div>
  </div>

  <!-- Modal za kupanje -->
  <div id="bathModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">üõÅ Kupanje</h2>
        <span class="close-btn" onclick="closeModal('bath')">&times;</span>
      </div>

      <div class="form-group">
        <label class="form-label">Vrijeme</label>
        <input type="datetime-local" id="bathTime" class="form-input">
      </div>

      <div class="form-group">
        <label class="form-label">Temperatura vode</label>
        <input type="text" id="bathTemp" class="form-input" placeholder="npr. 37¬∞C">
      </div>

      <div class="form-group">
        <label class="form-label">Bilje≈°ke</label>
        <textarea id="bathNotes" class="form-textarea" placeholder="Dodatne bilje≈°ke..."></textarea>
      </div>

      <button class="submit-btn" onclick="saveBath()">Spremi</button>
    </div>
  </div>

  <!-- Modal za lijekove -->
  <div id="medicineModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">üíä Lijekovi/Kapi</h2>
        <span class="close-btn" onclick="closeModal('medicine')">&times;</span>
      </div>

      <div class="form-group">
        <label class="form-label">Vrijeme</label>
        <input type="datetime-local" id="medicineTime" class="form-input">
      </div>

      <div class="form-group">
        <label class="form-label">Naziv lijeka/kapi</label>
        <input type="text" id="medicineName" class="form-input" placeholder="npr. Espumisan kapi">
      </div>

      <div class="form-group">
        <label class="form-label">Doza</label>
        <input type="text" id="medicineDose" class="form-input" placeholder="npr. 10 kapi">
      </div>

      <div class="form-group">
        <label class="form-label">Bilje≈°ke</label>
        <textarea id="medicineNotes" class="form-textarea" placeholder="Dodatne bilje≈°ke..."></textarea>
      </div>

      <button class="submit-btn" onclick="saveMedicine()">Spremi</button>
    </div>
  </div>

  <!-- Modal za grƒçeve -->
  <div id="colicModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">üò£ Grƒçevi</h2>
        <span class="close-btn" onclick="closeModal('colic')">&times;</span>
      </div>

      <div id="colicTimer" class="timer-display" style="display:none;">
        <div class="timer-text" id="colicTimerText">00:00:00</div>
        <div class="timer-label">Trajanje grƒçeva</div>
      </div>

      <div class="form-group">
        <label class="form-label">Poƒçetak</label>
        <input type="datetime-local" id="colicStartTime" class="form-input">
      </div>

      <div class="form-group">
        <label class="form-label">Trajanje (minute)</label>
        <input type="number" id="colicDuration" class="form-input" min="1" placeholder="npr. 30">
      </div>

      <div class="form-group">
        <label class="form-label">Intenzitet</label>
        <div class="button-group" id="intensityButtons">
          <button class="toggle-btn" data-value="mild" onclick="selectIntensity(this)">Blago</button>
          <button class="toggle-btn" data-value="moderate" onclick="selectIntensity(this)">Umjereno</button>
          <button class="toggle-btn" data-value="severe" onclick="selectIntensity(this)">Jako</button>
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">Bilje≈°ke</label>
        <textarea id="colicNotes" class="form-textarea" placeholder="≈†to je pomoglo..."></textarea>
      </div>

      <button class="submit-btn" id="colicStartBtn" onclick="startColicTimer()" style="background: var(--color-orange-500);">Pokreni tajmer</button>
      <button class="submit-btn" id="colicStopBtn" onclick="stopColicTimer()" style="display:none; background: var(--color-green-500);">Zaustavi tajmer</button>
      <div style="height: 12px;"></div>
      <button class="submit-btn" id="colicSubmitBtn" onclick="saveColic()">Spremi</button>
    </div>
  </div>

  <!-- Modal za kontrolu -->
  <div id="checkupModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">üè• Kontrola</h2>
        <span class="close-btn" onclick="closeModal('checkup')">&times;</span>
      </div>

      <div class="form-group">
        <label class="form-label">Datum i vrijeme kontrole</label>
        <input type="datetime-local" id="checkupTime" class="form-input">
      </div>

      <div class="form-group">
        <label class="form-label">Doktor/Klinika</label>
        <input type="text" id="checkupDoctor" class="form-input" placeholder="npr. Dr. Horvat">
      </div>

      <div class="form-group">
        <label class="form-label">Te≈æina (kg)</label>
        <input type="number" id="checkupWeight" class="form-input" step="0.1" placeholder="npr. 4.5">
      </div>

      <div class="form-group">
        <label class="form-label">Visina (cm)</label>
        <input type="number" id="checkupHeight" class="form-input" step="0.5" placeholder="npr. 55">
      </div>

      <div class="form-group">
        <label class="form-label">Bilje≈°ke</label>
        <textarea id="checkupNotes" class="form-textarea" placeholder="Nalazi, preporuke..."></textarea>
      </div>

      <button class="submit-btn" onclick="saveCheckup()">Spremi</button>
    </div>
  </div>

  <!-- Modal za podsjetnik -->
  <div id="reminderModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">üîî Podsjetnik</h2>
        <span class="close-btn" onclick="closeModal('reminder')">&times;</span>
      </div>

      <div class="form-group">
        <label class="form-label">Naslov</label>
        <input type="text" id="reminderTitle" class="form-input" placeholder="npr. Vakcinacija">
      </div>

      <div class="form-group">
        <label class="form-label">Datum i vrijeme</label>
        <input type="datetime-local" id="reminderTime" class="form-input">
      </div>

      <div class="form-group">
        <label class="form-label">Opis</label>
        <textarea id="reminderDesc" class="form-textarea" placeholder="Detalji..."></textarea>
      </div>

      <button class="submit-btn" onclick="saveReminder()">Spremi</button>
    </div>
  </div>

  <!-- Bottom Navigation -->
  <div class="bottom-nav">
    <div class="nav-item active" data-page="home" onclick="switchPage('home')">
      <div class="nav-icon">üè†</div>
      <div class="nav-label">Poƒçetna</div>
    </div>
    <div class="nav-item" data-page="history" onclick="switchPage('history')">
      <div class="nav-icon">üìä</div>
      <div class="nav-label">Historija</div>
    </div>
    <div class="nav-item" data-page="checkup" onclick="switchPage('checkup')">
      <div class="nav-icon">üè•</div>
      <div class="nav-label">Kontrole</div>
    </div>
    <div class="nav-item" data-page="reminders" onclick="switchPage('reminders')">
      <div class="nav-icon" style="position: relative;">
        üîî
        <span id="reminderBadge" class="notification-badge" style="display:none;">0</span>
      </div>
      <div class="nav-label">Podsjetnici</div>
    </div>
  </div>

  <script>
    // -----------------------------
    // PODESAVANJA / POMOCNE FUNKCIJE
    // -----------------------------
    const TZ = "Europe/Sarajevo";

    function getTZParts(date = new Date(), timeZone = TZ) {
      const dtf = new Intl.DateTimeFormat("en-GB", {
        timeZone,
        year: "numeric",
        month: "2-digit",
        day: "2-digit",
        hour: "2-digit",
        minute: "2-digit",
        second: "2-digit",
        hour12: false
      });
      const parts = dtf.formatToParts(date);
      const map = {};
      parts.forEach(p => { if (p.type !== "literal") map[p.type] = p.value; });
      return map; // {year, month, day, hour, minute, second}
    }

    function nowISOInTZ() {
      // "Sada" u TZ, pretvoreno u ISO (pribli≈æno, dovoljno za ovu app)
      const p = getTZParts(new Date(), TZ);
      // Kreiramo lokalni Date iz tih dijelova (u lokalnoj zoni),
      // ali nam treba konzistentno i za prikaz i za raƒçunanje.
      // Za raƒçunanje trajanja koristimo realni Date.now() razliku kod aktivnih tajmera,
      // a za zapise ISO koristimo standardni ISO koji je ok.
      const localLike = new Date(`${p.year}-${p.month}-${p.day}T${p.hour}:${p.minute}:${p.second}`);
      return localLike.toISOString();
    }

    function valueForDatetimeLocalNow() {
      const p = getTZParts(new Date(), TZ);
      return `${p.year}-${p.month}-${p.day}T${p.hour}:${p.minute}`;
    }

    function formatTime(iso) {
      const d = new Date(iso);
      const dd = d.getDate();
      const mm = d.getMonth() + 1;
      const yy = d.getFullYear();
      const hh = String(d.getHours()).padStart(2, "0");
      const mi = String(d.getMinutes()).padStart(2, "0");

      const today = new Date(); today.setHours(0,0,0,0);
      const yesterday = new Date(today); yesterday.setDate(yesterday.getDate() - 1);

      const d0 = new Date(d); d0.setHours(0,0,0,0);

      if (d0.getTime() === today.getTime()) return `Danas ${hh}:${mi}`;
      if (d0.getTime() === yesterday.getTime()) return `Juƒçer ${hh}:${mi}`;
      return `${dd}.${mm}.${yy} ${hh}:${mi}`;
    }

    function formatTimeAgo(iso) {
      const now = Date.now();
      const then = new Date(iso).getTime();
      const diff = now - then;
      const minutes = Math.floor(diff / 60000);
      const hours = Math.floor(minutes / 60);
      const days = Math.floor(hours / 24);

      if (minutes < 1) return "upravo";
      if (minutes < 60) return `Prije ${minutes} min`;
      if (hours < 24) return `Prije ${hours}h`;
      return `Prije ${days} dana`;
    }

    function pad2(n){ return String(n).padStart(2,"0"); }

    function hmsFromMs(ms) {
      const total = Math.max(0, Math.floor(ms / 1000));
      const h = Math.floor(total / 3600);
      const m = Math.floor((total % 3600) / 60);
      const s = total % 60;
      return `${pad2(h)}:${pad2(m)}:${pad2(s)}`;
    }

    function escapeHtml(str) {
      return String(str || "")
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    // -----------------------------
    // STORAGE
    // -----------------------------
    let activities = JSON.parse(localStorage.getItem("babyActivities") || "[]");
    let checkups = JSON.parse(localStorage.getItem("babyCheckups") || "[]");
    let reminders = JSON.parse(localStorage.getItem("babyReminders") || "[]");

    // Aktivni procesi
    let activeSleep = JSON.parse(localStorage.getItem("activeSleep") || "null");     // {startIso, startMs, startDisplay}
    let activeFeeding = JSON.parse(localStorage.getItem("activeFeeding") || "null"); // {startIso, startDisplay, startMs, breast}

    // UI selections
    let selectedBreast = null;
    let selectedDiaperType = null;
    let selectedIntensity = null;
    let selectedFeedingReminderHours = null;

    // Timers
    let sleepInterval = null;
    let colicInterval = null;
    let colicStartMs = null;

    // -----------------------------
    // MODALI
    // -----------------------------
    function openModal(type) {
      const modal = document.getElementById(type + "Modal");
      if (!modal) return;
      modal.classList.add("active");

      // default vrijeme
      const map = {
        sleep: "sleepStartTime",
        feeding: "feedingStartTime",
        diaper: "diaperTime",
        bath: "bathTime",
        medicine: "medicineTime",
        colic: "colicStartTime",
        checkup: "checkupTime",
        reminder: "reminderTime"
      };

      if (map[type]) {
        const el = document.getElementById(map[type]);
        if (el && !el.value) el.value = valueForDatetimeLocalNow();
        // Podsjetnik neka ostane kako je uneseno, ali default mo≈æe
        if (el && type === "reminder" && !el.value) el.value = valueForDatetimeLocalNow();
      }

      // posebna logika: aktivni san / aktivno hranjenje
      if (type === "sleep") {
        if (activeSleep) {
          showActiveSleepUI();
        } else {
          resetSleepUI(false);
        }
      }

      if (type === "feeding") {
        if (activeFeeding) {
          showActiveFeedingUI();
        } else {
          resetFeedingUI(false);
        }
      }

      if (type === "colic") {
        // ni≈°ta posebno, samo default
        document.getElementById("colicTimer").style.display = "none";
        document.getElementById("colicStartBtn").style.display = "block";
        document.getElementById("colicStopBtn").style.display = "none";
      }
    }

    function closeModal(type) {
      const modal = document.getElementById(type + "Modal");
      if (!modal) return;
      modal.classList.remove("active");

      if (type === "sleep") {
        // Ne ubijaj aktivni san, samo reset UI da ne ostane interval u modalu
        if (sleepInterval) { clearInterval(sleepInterval); sleepInterval = null; }
        document.getElementById("sleepNotes").value = "";
        if (activeSleep) showActiveSleepUI(); else resetSleepUI(true);
      }

      if (type === "feeding") {
        document.getElementById("feedingNotes").value = "";
        document.getElementById("feedingEndTime").value = "";
        // Ne resetuj activeFeeding, samo UI
        if (activeFeeding) showActiveFeedingUI(); else resetFeedingUI(true);
      }

      if (type === "diaper") {
        document.getElementById("diaperNotes").value = "";
        document.querySelectorAll("#diaperButtons .toggle-btn").forEach(b => b.classList.remove("active"));
        selectedDiaperType = null;
      }

      if (type === "bath") {
        document.getElementById("bathTemp").value = "";
        document.getElementById("bathNotes").value = "";
      }

      if (type === "medicine") {
        document.getElementById("medicineName").value = "";
        document.getElementById("medicineDose").value = "";
        document.getElementById("medicineNotes").value = "";
      }

      if (type === "colic") {
        if (colicInterval) { clearInterval(colicInterval); colicInterval = null; }
        colicStartMs = null;
        document.getElementById("colicDuration").value = "";
        document.getElementById("colicNotes").value = "";
        document.querySelectorAll("#intensityButtons .toggle-btn").forEach(b => b.classList.remove("active"));
        selectedIntensity = null;
        document.getElementById("colicTimer").style.display = "none";
        document.getElementById("colicStartBtn").style.display = "block";
        document.getElementById("colicStopBtn").style.display = "none";
        document.getElementById("colicTimerText").textContent = "00:00:00";
      }

      if (type === "checkup") {
        document.getElementById("checkupDoctor").value = "";
        document.getElementById("checkupWeight").value = "";
        document.getElementById("checkupHeight").value = "";
        document.getElementById("checkupNotes").value = "";
      }

      if (type === "reminder") {
        document.getElementById("reminderTitle").value = "";
        document.getElementById("reminderDesc").value = "";
      }
    }

    // zatvori klikom izvan
    document.querySelectorAll(".modal").forEach(modal => {
      modal.addEventListener("click", (e) => {
        if (e.target === modal) {
          const type = modal.id.replace("Modal", "");
          closeModal(type);
        }
      });
    });

    // -----------------------------
    // SLEEP
    // -----------------------------
    function resetSleepUI(fullReset) {
      document.getElementById("sleepTimer").style.display = "none";
      document.getElementById("sleepStartBtn").style.display = "block";
      document.getElementById("sleepWakeBtn").style.display = "none";
      document.getElementById("sleepStartGroup").style.display = "block";
      document.getElementById("sleepEndGroup").style.display = "none";
      document.getElementById("sleepTimerText").textContent = "00:00:00";
      document.getElementById("sleepTimerLabel").textContent = "Vrijeme spavanja";
      if (fullReset) {
        document.getElementById("sleepStartTime").value = "";
        document.getElementById("sleepEndTime").value = "";
      }
    }

    function showActiveSleepUI() {
      resetSleepUI(false);
      document.getElementById("sleepTimer").style.display = "block";
      document.getElementById("sleepStartBtn").style.display = "none";
      document.getElementById("sleepWakeBtn").style.display = "block";
      document.getElementById("sleepStartGroup").style.display = "none";
      document.getElementById("sleepEndGroup").style.display = "none";

      if (sleepInterval) { clearInterval(sleepInterval); sleepInterval = null; }

      // Timer u modalu
      sleepInterval = setInterval(() => {
        const elapsed = Date.now() - activeSleep.startMs;
        document.getElementById("sleepTimerText").textContent = hmsFromMs(elapsed);
        document.getElementById("sleepTimerLabel").textContent = `Poƒçeo spavati u ${activeSleep.startDisplay}`;
      }, 500);

      // odmah update
      const elapsed = Date.now() - activeSleep.startMs;
      document.getElementById("sleepTimerText").textContent = hmsFromMs(elapsed);
      document.getElementById("sleepTimerLabel").textContent = `Poƒçeo spavati u ${activeSleep.startDisplay}`;
    }

    function startSleep() {
      if (activeSleep) return;

      const manual = document.getElementById("sleepStartTime").value;
      let startDate;
      if (manual) {
        startDate = new Date(manual);
      } else {
        startDate = new Date(nowISOInTZ());
      }

      // Ako user unese nerealno buduƒáe vrijeme
      if (startDate.getTime() > Date.now() + 60000) {
        alert("Poƒçetak spavanja ne mo≈æe biti u buduƒánosti.");
        return;
      }

      const startIso = startDate.toISOString();
      const startDisplay = startDate.toLocaleString("hr-HR", { hour: "2-digit", minute: "2-digit" });

      activeSleep = {
        startIso,
        startMs: startDate.getTime(),
        startDisplay
      };
      localStorage.setItem("activeSleep", JSON.stringify(activeSleep));

      updateSleepQuickButton(true);
      closeModal("sleep"); // zatvori
      // timer na home (quick)
      ensureHomeIntervals();
      updateDisplay();
    }

    function wakeSleep() {
      if (!activeSleep) return;

      const endDate = new Date(nowISOInTZ());
      const durationHours = (endDate.getTime() - activeSleep.startMs) / 3600000;

      if (durationHours <= 0) {
        alert("Gre≈°ka u vremenima!");
        return;
      }

      const notes = document.getElementById("sleepNotes").value || "";
      const endDisplay = endDate.toLocaleString("hr-HR", { hour: "2-digit", minute: "2-digit" });

      activities.push({
        type: "sleep",
        time: activeSleep.startIso,
        endTime: endDate.toISOString(),
        duration: durationHours,
        notes,
        startTimeDisplay: activeSleep.startDisplay,
        endTimeDisplay: endDisplay,
        timestamp: Date.now()
      });

      activeSleep = null;
      localStorage.removeItem("activeSleep");
      if (sleepInterval) { clearInterval(sleepInterval); sleepInterval = null; }

      updateSleepQuickButton(false);
      saveAndRefresh();
      closeModal("sleep");
    }

    function updateSleepQuickButton(isSleeping) {
      const el = document.getElementById("sleepLastTime");
      if (!el) return;

      if (isSleeping && activeSleep) {
        const elapsed = Date.now() - activeSleep.startMs;
        const hours = Math.floor(elapsed / 3600000);
        const minutes = Math.floor((elapsed % 3600000) / 60000);
        el.textContent = `üõèÔ∏è Spava ${hours}h ${minutes}min`;
        el.style.color = "var(--color-purple-500)";
        el.style.fontWeight = "600";
      } else {
        el.style.color = "";
        el.style.fontWeight = "";
      }
    }

    // -----------------------------
    // FEEDING
    // -----------------------------
    function resetFeedingUI(fullReset) {
      document.getElementById("feedingInfo").style.display = "none";
      document.getElementById("feedingStartBtn").style.display = "block";
      document.getElementById("feedingEndBtn").style.display = "none";
      document.getElementById("feedingStartGroup").style.display = "block";
      document.getElementById("feedingEndGroup").style.display = "none";

      document.querySelectorAll("#breastButtons .toggle-btn").forEach(b => b.classList.remove("active"));
      selectedBreast = null;

      const chk = document.getElementById("feedingReminderCheck");
      chk.checked = false;
      document.getElementById("feedingReminderGroup").style.display = "none";
      selectedFeedingReminderHours = null;
      document.querySelectorAll("#feedingReminderGroup .toggle-btn").forEach(b => b.classList.remove("active"));

      if (fullReset) {
        document.getElementById("feedingStartTime").value = "";
        document.getElementById("feedingEndTime").value = "";
      }
    }

    function showActiveFeedingUI() {
      resetFeedingUI(false);

      // selekcija dojke (zakljuƒçaj vizuelno)
      selectedBreast = activeFeeding.breast;
      document.querySelectorAll("#breastButtons .toggle-btn").forEach(btn => {
        if (btn.dataset.value === activeFeeding.breast) btn.classList.add("active");
      });

      document.getElementById("feedingStartBtn").style.display = "none";
      document.getElementById("feedingEndBtn").style.display = "block";
      document.getElementById("feedingStartGroup").style.display = "none";
      document.getElementById("feedingEndGroup").style.display = "block";
      document.getElementById("feedingEndTime").value = valueForDatetimeLocalNow();

      document.getElementById("feedingInfo").style.display = "block";
      document.getElementById("feedingInfoLabel").textContent = `Poƒçeo jesti u ${activeFeeding.startDisplay}`;
    }

    function selectBreast(btn) {
      document.querySelectorAll("#breastButtons .toggle-btn").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      selectedBreast = btn.dataset.value;
    }

    function selectFeedingReminderHours(btn) {
      document.querySelectorAll("#feedingReminderGroup .toggle-btn").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      selectedFeedingReminderHours = parseFloat(btn.dataset.value);
    }

    document.getElementById("feedingReminderCheck").addEventListener("change", (e) => {
      const group = document.getElementById("feedingReminderGroup");
      if (e.target.checked) {
        group.style.display = "block";
      } else {
        group.style.display = "none";
        selectedFeedingReminderHours = null;
        document.querySelectorAll("#feedingReminderGroup .toggle-btn").forEach(b => b.classList.remove("active"));
      }
    });

    function startFeeding() {
      if (activeFeeding) return;
      if (!selectedBreast) {
        alert("Molimo odaberite dojku!");
        return;
      }

      const manual = document.getElementById("feedingStartTime").value;
      let startDate;
      if (manual) startDate = new Date(manual);
      else startDate = new Date(nowISOInTZ());

      if (startDate.getTime() > Date.now() + 60000) {
        alert("Poƒçetak hranjenja ne mo≈æe biti u buduƒánosti.");
        return;
      }

      const startIso = startDate.toISOString();
      const startDisplay = startDate.toLocaleString("hr-HR", { day: "2-digit", month: "2-digit", year: "numeric", hour: "2-digit", minute: "2-digit" });

      activeFeeding = {
        startIso,
        startMs: startDate.getTime(),
        startDisplay,
        breast: selectedBreast
      };
      localStorage.setItem("activeFeeding", JSON.stringify(activeFeeding));

      updateFeedingQuickButton(true);
      closeModal("feeding");
      ensureHomeIntervals();
      updateDisplay();
    }

    function endFeeding() {
      if (!activeFeeding) return;

      const endVal = document.getElementById("feedingEndTime").value;
      let endDate;
      if (endVal) endDate = new Date(endVal);
      else endDate = new Date(nowISOInTZ());

      const durationMin = Math.round((endDate.getTime() - activeFeeding.startMs) / 60000);
      if (durationMin <= 0) {
        alert("Gre≈°ka u vremenima!");
        return;
      }

      const notes = document.getElementById("feedingNotes").value || "";
      const endDisplay = endDate.toLocaleString("hr-HR", { day: "2-digit", month: "2-digit", year: "numeric", hour: "2-digit", minute: "2-digit" });

      activities.push({
        type: "feeding",
        time: activeFeeding.startIso,
        endTime: endDate.toISOString(),
        breast: activeFeeding.breast,
        duration: durationMin,
        notes,
        startTimeDisplay: activeFeeding.startDisplay,
        endTimeDisplay: endDisplay,
        timestamp: Date.now()
      });

      // Podsjetnik za hranjenje (ako je izabran)
      const reminderCheck = document.getElementById("feedingReminderCheck").checked;
      if (reminderCheck && selectedFeedingReminderHours) {
        const rt = new Date(endDate.getTime() + selectedFeedingReminderHours * 3600000);
        reminders.push({
          title: "Vrijeme za hranjenje",
          time: rt.toISOString(),
          description: `Pro≈°lo je ${selectedFeedingReminderHours}h od posljednjeg hranjenja`,
          timestamp: Date.now(),
          notified: false
        });
        localStorage.setItem("babyReminders", JSON.stringify(reminders));
      }

      activeFeeding = null;
      localStorage.removeItem("activeFeeding");

      updateFeedingQuickButton(false);
      saveAndRefresh();
      closeModal("feeding");
      updateReminders();
    }

    function updateFeedingQuickButton(isFeeding) {
      const el = document.getElementById("feedingLastTime");
      if (!el) return;

      if (isFeeding && activeFeeding) {
        const breastText = activeFeeding.breast === "left" ? "lijeva" : activeFeeding.breast === "right" ? "desna" : "obje";
        el.textContent = `üçº Jede (${breastText}) od ${activeFeeding.startDisplay}`;
        el.style.color = "var(--color-pink-500)";
        el.style.fontWeight = "600";
      } else {
        el.style.color = "";
        el.style.fontWeight = "";
      }
    }

    // -----------------------------
    // DIAPER / BATH / MEDICINE / COLIC
    // -----------------------------
    function selectDiaperType(btn) {
      document.querySelectorAll("#diaperButtons .toggle-btn").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      selectedDiaperType = btn.dataset.value;
    }

    function saveDiaper() {
      const val = document.getElementById("diaperTime").value;
      if (!val || !selectedDiaperType) {
        alert("Molimo unesite vrijeme i odaberite tip!");
        return;
      }
      const notes = document.getElementById("diaperNotes").value || "";
      activities.push({
        type: "diaper",
        time: new Date(val).toISOString(),
        diaperType: selectedDiaperType,
        notes,
        timestamp: Date.now()
      });
      saveAndRefresh();
      closeModal("diaper");
    }

    function saveBath() {
      const val = document.getElementById("bathTime").value;
      if (!val) { alert("Molimo unesite vrijeme!"); return; }
      const temp = document.getElementById("bathTemp").value || "";
      const notes = document.getElementById("bathNotes").value || "";
      activities.push({
        type: "bath",
        time: new Date(val).toISOString(),
        temperature: temp,
        notes,
        timestamp: Date.now()
      });
      saveAndRefresh();
      closeModal("bath");
    }

    function saveMedicine() {
      const val = document.getElementById("medicineTime").value;
      const name = document.getElementById("medicineName").value.trim();
      if (!val || !name) { alert("Molimo unesite vrijeme i naziv!"); return; }
      const dose = document.getElementById("medicineDose").value || "";
      const notes = document.getElementById("medicineNotes").value || "";
      activities.push({
        type: "medicine",
        time: new Date(val).toISOString(),
        name,
        dose,
        notes,
        timestamp: Date.now()
      });
      saveAndRefresh();
      closeModal("medicine");
    }

    function selectIntensity(btn) {
      document.querySelectorAll("#intensityButtons .toggle-btn").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      selectedIntensity = btn.dataset.value;
    }

    function startColicTimer() {
      if (!selectedIntensity) {
        alert("Molimo odaberite intenzitet prije pokretanja tajmera!");
        return;
      }
      colicStartMs = Date.now();
      document.getElementById("colicTimer").style.display = "block";
      document.getElementById("colicStartBtn").style.display = "none";
      document.getElementById("colicStopBtn").style.display = "block";

      if (colicInterval) { clearInterval(colicInterval); colicInterval = null; }
      colicInterval = setInterval(() => {
        document.getElementById("colicTimerText").textContent = hmsFromMs(Date.now() - colicStartMs);
      }, 500);
    }

    function stopColicTimer() {
      if (!colicStartMs) return;
      if (colicInterval) { clearInterval(colicInterval); colicInterval = null; }
      const minutes = Math.max(1, Math.round((Date.now() - colicStartMs) / 60000));
      document.getElementById("colicDuration").value = minutes;
      document.getElementById("colicTimer").style.display = "none";
      document.getElementById("colicStartBtn").style.display = "block";
      document.getElementById("colicStopBtn").style.display = "none";
      document.getElementById("colicTimerText").textContent = "00:00:00";
      colicStartMs = null;
    }

    function saveColic() {
      const startVal = document.getElementById("colicStartTime").value;
      const durVal = document.getElementById("colicDuration").value;
      if (!startVal || !durVal || !selectedIntensity) {
        alert("Molimo popunite sva obavezna polja!");
        return;
      }
      const notes = document.getElementById("colicNotes").value || "";
      activities.push({
        type: "colic",
        time: new Date(startVal).toISOString(),
        duration: parseInt(durVal, 10),
        intensity: selectedIntensity,
        notes,
        timestamp: Date.now()
      });
      saveAndRefresh();
      closeModal("colic");
    }

    // -----------------------------
    // CHECKUP / REMINDER
    // -----------------------------
    function saveCheckup() {
      const val = document.getElementById("checkupTime").value;
      if (!val) { alert("Molimo unesite datum kontrole!"); return; }

      const doctor = document.getElementById("checkupDoctor").value || "";
      const weight = document.getElementById("checkupWeight").value;
      const height = document.getElementById("checkupHeight").value;
      const notes = document.getElementById("checkupNotes").value || "";

      checkups.push({
        time: new Date(val).toISOString(),
        doctor,
        weight: weight ? Number(weight) : null,
        height: height ? Number(height) : null,
        notes,
        timestamp: Date.now()
      });

      localStorage.setItem("babyCheckups", JSON.stringify(checkups));
      updateCheckups();
      closeModal("checkup");
    }

    function saveReminder() {
      const title = document.getElementById("reminderTitle").value.trim();
      const val = document.getElementById("reminderTime").value;
      if (!title || !val) { alert("Molimo unesite naslov i vrijeme!"); return; }
      const desc = document.getElementById("reminderDesc").value || "";

      reminders.push({
        title,
        time: new Date(val).toISOString(),
        description: desc,
        timestamp: Date.now(),
        notified: false
      });

      localStorage.setItem("babyReminders", JSON.stringify(reminders));
      updateReminders();
      closeModal("reminder");
    }

    function deleteReminder(index) {
      if (!confirm("Obrisati podsjetnik?")) return;
      reminders.splice(index, 1);
      localStorage.setItem("babyReminders", JSON.stringify(reminders));
      updateReminders();
    }

    // -----------------------------
    // PRIKAZ / STATISTIKA
    // -----------------------------
    function getActivityIcon(activity) {
      const icons = {
        sleep: { emoji: "üò¥", bg: "rgba(192, 132, 252, 0.15)", color: "var(--color-purple-500)" },
        feeding: { emoji: "üçº", bg: "rgba(236, 72, 153, 0.15)", color: "var(--color-pink-500)" },
        diaper: { emoji: "üë∂", bg: "rgba(96, 165, 250, 0.15)", color: "var(--color-blue-500)" },
        bath: { emoji: "üõÅ", bg: "rgba(33, 128, 141, 0.15)", color: "var(--color-teal-500)" },
        medicine: { emoji: "üíä", bg: "rgba(251, 146, 60, 0.15)", color: "var(--color-orange-500)" },
        colic: { emoji: "üò£", bg: "rgba(251, 146, 60, 0.15)", color: "var(--color-orange-500)" }
      };
      return icons[activity.type] || icons.sleep;
    }

    function getActivityTitle(activity) {
      const titles = {
        sleep: "San",
        feeding: "Hranjenje",
        diaper: "Pelena",
        bath: "Kupanje",
        medicine: "Lijek",
        colic: "Grƒçevi"
      };
      return titles[activity.type] || "Aktivnost";
    }

    function getActivityDetails(activity) {
      switch (activity.type) {
        case "sleep":
          return `${(activity.duration || 0).toFixed(1)}h (${activity.startTimeDisplay || "-"} - ${activity.endTimeDisplay || "-"})` +
            (activity.notes ? ` ‚Ä¢ ${escapeHtml(activity.notes)}` : "");
        case "feeding": {
          const breastText = activity.breast === "left" ? "lijeva" : activity.breast === "right" ? "desna" : "obje";
          return `${activity.duration || 0} min (${breastText})` + (activity.notes ? ` ‚Ä¢ ${escapeHtml(activity.notes)}` : "");
        }
        case "diaper": {
          const typeText = activity.diaperType === "wet" ? "Mokra" : activity.diaperType === "dirty" ? "Prljava" : "Oboje";
          return `${typeText}` + (activity.notes ? ` ‚Ä¢ ${escapeHtml(activity.notes)}` : "");
        }
        case "bath":
          return (activity.temperature ? `Temp: ${escapeHtml(activity.temperature)}` : "Kupanje") + (activity.notes ? ` ‚Ä¢ ${escapeHtml(activity.notes)}` : "");
        case "medicine":
          return `${escapeHtml(activity.name || "")}${activity.dose ? ` - ${escapeHtml(activity.dose)}` : ""}` + (activity.notes ? ` ‚Ä¢ ${escapeHtml(activity.notes)}` : "");
        case "colic": {
          const intensityText = activity.intensity === "mild" ? "Blago" : activity.intensity === "moderate" ? "Umjereno" : "Jako";
          return `${activity.duration || 0} min (${intensityText})` + (activity.notes ? ` ‚Ä¢ ${escapeHtml(activity.notes)}` : "");
        }
        default:
          return "";
      }
    }

    function updateRecentActivities() {
      const container = document.getElementById("recentActivities");
      const sorted = [...activities].sort((a,b) => (b.timestamp||0) - (a.timestamp||0));
      const recent = sorted.slice(0, 5);

      if (!recent.length) {
        container.innerHTML = '<div class="empty-state">Nema aktivnosti</div>';
        return;
      }

      container.innerHTML = recent.map(a => {
        const icon = getActivityIcon(a);
        const title = getActivityTitle(a);
        const details = getActivityDetails(a);
        const time = formatTime(a.time);
        return `
          <div class="activity-item">
            <div class="activity-icon" style="background:${icon.bg}; color:${icon.color};">${icon.emoji}</div>
            <div class="activity-content">
              <div class="activity-title">${title}</div>
              <div class="activity-details">${details}</div>
            </div>
            <div class="activity-time">${time}</div>
          </div>
        `;
      }).join("");
    }

    function updateAllActivities() {
      const container = document.getElementById("allActivities");
      const sorted = [...activities].sort((a,b) => (b.timestamp||0) - (a.timestamp||0));

      if (!sorted.length) {
        container.innerHTML = '<div class="empty-state">Nema aktivnosti</div>';
        return;
      }

      container.innerHTML = sorted.map(a => {
        const icon = getActivityIcon(a);
        const title = getActivityTitle(a);
        const details = getActivityDetails(a);
        const time = formatTime(a.time);
        return `
          <div class="activity-item">
            <div class="activity-icon" style="background:${icon.bg}; color:${icon.color};">${icon.emoji}</div>
            <div class="activity-content">
              <div class="activity-title">${title}</div>
              <div class="activity-details">${details}</div>
            </div>
            <div class="activity-time">${time}</div>
          </div>
        `;
      }).join("");
    }

    function updateStats() {
      const startOfToday = new Date(); startOfToday.setHours(0,0,0,0);
      const todayActs = activities.filter(a => new Date(a.time) >= startOfToday);

      document.getElementById("todaySleepCount").textContent = todayActs.filter(a => a.type === "sleep").length;
      document.getElementById("todayFeedingCount").textContent = todayActs.filter(a => a.type === "feeding").length;
      document.getElementById("todayDiaperCount").textContent = todayActs.filter(a => a.type === "diaper").length;

      const totalSleep = todayActs.filter(a => a.type === "sleep").reduce((sum,a) => sum + (Number(a.duration)||0), 0);
      document.getElementById("todayTotalSleep").textContent = `${totalSleep.toFixed(1)}h`;
    }

    function updateLastTimes() {
      const lastSleep = activities.filter(a => a.type === "sleep").sort((a,b)=> (b.timestamp||0)-(a.timestamp||0))[0];
      const lastFeeding = activities.filter(a => a.type === "feeding").sort((a,b)=> (b.timestamp||0)-(a.timestamp||0))[0];

      document.getElementById("lastSleepTime").textContent = lastSleep ? formatTimeAgo(lastSleep.time) : "-";
      document.getElementById("lastFeedingTime").textContent = lastFeeding ? formatTimeAgo(lastFeeding.time) : "-";

      // quick buttons (ako nema aktivnih)
      if (!activeSleep) document.getElementById("sleepLastTime").textContent = lastSleep ? formatTimeAgo(lastSleep.time) : "-";
      if (!activeFeeding) document.getElementById("feedingLastTime").textContent = lastFeeding ? formatTimeAgo(lastFeeding.time) : "-";

      const lastDiaper = activities.filter(a => a.type === "diaper").sort((a,b)=> (b.timestamp||0)-(a.timestamp||0))[0];
      document.getElementById("diaperLastTime").textContent = lastDiaper ? formatTimeAgo(lastDiaper.time) : "-";

      const lastBath = activities.filter(a => a.type === "bath").sort((a,b)=> (b.timestamp||0)-(a.timestamp||0))[0];
      document.getElementById("bathLastTime").textContent = lastBath ? formatTimeAgo(lastBath.time) : "-";

      const lastMedicine = activities.filter(a => a.type === "medicine").sort((a,b)=> (b.timestamp||0)-(a.timestamp||0))[0];
      document.getElementById("medicineLastTime").textContent = lastMedicine ? formatTimeAgo(lastMedicine.time) : "-";

      const lastColic = activities.filter(a => a.type === "colic").sort((a,b)=> (b.timestamp||0)-(a.timestamp||0))[0];
      document.getElementById("colicLastTime").textContent = lastColic ? formatTimeAgo(lastColic.time) : "-";

      // aktivni quick prikaz
      if (activeSleep) updateSleepQuickButton(true);
      if (activeFeeding) updateFeedingQuickButton(true);
    }

    function updateCheckups() {
      const container = document.getElementById("checkupList");
      const sorted = [...checkups].sort((a,b) => new Date(b.time) - new Date(a.time));

      if (!sorted.length) {
        container.innerHTML = '<div class="empty-state">Nema unesenih kontrola</div>';
        return;
      }

      container.innerHTML = sorted.map(ch => {
        const time = formatTime(ch.time);
        const details = [];
        if (ch.weight) details.push(`${ch.weight} kg`);
        if (ch.height) details.push(`${ch.height} cm`);
        const notes = ch.notes ? `<div class="activity-details" style="margin-top:4px;">${escapeHtml(ch.notes)}</div>` : "";

        return `
          <div class="activity-item">
            <div class="activity-icon" style="background: rgba(34,197,94,0.15); color: var(--color-green-500);">üè•</div>
            <div class="activity-content">
              <div class="activity-title">${escapeHtml(ch.doctor || "Kontrola")}</div>
              <div class="activity-details">${details.join(" ‚Ä¢ ")}</div>
              ${notes}
            </div>
            <div class="activity-time">${time}</div>
          </div>
        `;
      }).join("");
    }

    function updateReminders() {
      const container = document.getElementById("remindersList");
      const now = new Date();
      const sorted = [...reminders].sort((a,b) => new Date(a.time) - new Date(b.time));

      if (!sorted.length) {
        container.innerHTML = '<div class="empty-state">Nema podsjetnika</div>';
        document.getElementById("reminderBadge").style.display = "none";
        return;
      }

      const activeCount = sorted.filter(r => new Date(r.time) > now).length;
      const badge = document.getElementById("reminderBadge");
      if (activeCount > 0) {
        badge.textContent = activeCount;
        badge.style.display = "flex";
      } else {
        badge.style.display = "none";
      }

      container.innerHTML = sorted.map((r, idx) => {
        const t = formatTime(r.time);
        const isPast = new Date(r.time) < now;
        return `
          <div class="reminder-item" style="${isPast ? "opacity:0.6;" : ""}">
            <div class="reminder-content">
              <div class="reminder-title">${escapeHtml(r.title)}</div>
              <div class="reminder-time">${t}</div>
              ${r.description ? `<div class="reminder-time" style="margin-top:4px;">${escapeHtml(r.description)}</div>` : ""}
            </div>
            <div class="delete-btn" onclick="deleteReminder(${idx})">üóëÔ∏è</div>
          </div>
        `;
      }).join("");
    }

    function updateDisplay() {
      updateRecentActivities();
      updateAllActivities();
      updateStats();
      updateLastTimes();
      updateCheckups();
      updateReminders();
    }

    function saveAndRefresh() {
      localStorage.setItem("babyActivities", JSON.stringify(activities));
      updateDisplay();
    }

    // -----------------------------
    // NAVIGACIJA (fix: bez event bug-a)
    // -----------------------------
    function switchPage(page) {
      document.querySelectorAll(".page").forEach(p => p.classList.remove("active"));
      document.querySelectorAll(".nav-item").forEach(n => n.classList.remove("active"));

      const pageEl = document.getElementById(page + "Page");
      if (pageEl) pageEl.classList.add("active");

      const nav = document.querySelector(`.nav-item[data-page="${page}"]`);
      if (nav) nav.classList.add("active");
    }

    // -----------------------------
    // NOTIFIKACIJE PODSJETNIKA
    // -----------------------------
    function requestNotificationPermission() {
      if ("Notification" in window && Notification.permission === "default") {
        Notification.requestPermission();
      }
    }

    function showReminderNotification(reminder) {
      // fallback
      const msg = `${reminder.title}\n${reminder.description || ""}`.trim();

      if (!("Notification" in window)) {
        alert("Podsjetnik:\n\n" + msg);
        return;
      }

      if (Notification.permission === "granted") {
        const n = new Notification("Baby Tracker", { body: msg });
        n.onclick = () => { window.focus(); switchPage("reminders"); n.close(); };
        return;
      }

      // ako denied ili default
      alert("Podsjetnik:\n\n" + msg);
    }

    function checkDueReminders() {
      const now = new Date();
      let changed = false;

      // obavijesti u prozoru od 60 sekundi
      reminders.forEach(r => {
        const rt = new Date(r.time);
        const diff = rt.getTime() - now.getTime();
        if (diff <= 0) return;
        if (diff < 60000 && !r.notified) {
          showReminderNotification(r);
          r.notified = true;
          changed = true;
        }
      });

      if (changed) {
        localStorage.setItem("babyReminders", JSON.stringify(reminders));
        updateReminders();
      }
    }

    // -----------------------------
    // HOME INTERVALI (aktivni procesi)
    // -----------------------------
    let homeInterval = null;

    function ensureHomeIntervals() {
      if (homeInterval) return;
      homeInterval = setInterval(() => {
        if (activeSleep) updateSleepQuickButton(true);
        if (activeFeeding) updateFeedingQuickButton(true);
        updateLastTimes();
        checkDueReminders();
      }, 1000);
    }

    // -----------------------------
    // INIT
    // -----------------------------
    // aktivni procesi: quick prikaz
    if (activeSleep) updateSleepQuickButton(true);
    if (activeFeeding) updateFeedingQuickButton(true);

    updateDisplay();
    requestNotificationPermission();
    ensureHomeIntervals();

    // provjera podsjetnika svakih 30 sekundi (uz home interval veƒá 1s radi checkDueReminders)
    setInterval(updateReminders, 30000);
  </script>
</body>
</html>

