<!DOCTYPE html>
<html lang="bs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>üë∂ Nori Tracker</title>
  <style>
    :root{
      --w: rgba(255,255,255,1);
      --bg1: rgba(252,252,249,1);
      --bg2: rgba(255,255,253,1);
      --g2: rgba(245,245,245,1);
      --g3: rgba(167,169,169,1);
      --sl: rgba(98,108,113,1);
      --br: rgba(94,82,64,1);
      --c7: rgba(31,33,33,1);
      --c8: rgba(38,40,40,1);

      --teal: rgba(33,128,141,1);
      --teal2: rgba(29,116,128,1);
      --teal3: rgba(26,104,115,1);

      --pink: rgba(219,39,119,1);
      --pink2: rgba(236,72,153,1);

      --purple: rgba(168,85,247,1);
      --purple2: rgba(192,132,252,1);

      --blue: rgba(59,130,246,1);
      --blue2: rgba(96,165,250,1);

      --orange: rgba(249,115,22,1);
      --orange2: rgba(251,146,60,1);

      --green: rgba(34,197,94,1);
      --green2: rgba(74,222,128,1);

      --br-rgb: 94, 82, 64;
      --teal-rgb: 33, 128, 141;

      --bg: var(--bg1);
      --surface: rgba(255,255,255,0.78);
      --surface2: rgba(255,255,255,0.92);
      --text: rgba(31,33,33,1);
      --muted: rgba(98,108,113,1);
      --border: rgba(var(--br-rgb), 0.16);

      --r8: 10px;
      --r12: 14px;
      --r20: 20px;
      --rfull: 9999px;

      --s8: 8px;
      --s10: 10px;
      --s12: 12px;
      --s14: 14px;
      --s16: 16px;
      --s18: 18px;
      --s20: 20px;
      --s24: 24px;

      --sh1: 0 10px 30px rgba(0,0,0,0.06);
      --sh2: 0 2px 10px rgba(0,0,0,0.06);

      --ring: 0 0 0 3px rgba(33,128,141,0.18);

      --navH: 76px;
    }

    @media (prefers-color-scheme: dark){
      :root{
        --bg: rgba(31,33,33,1);
        --surface: rgba(38,40,40,0.78);
        --surface2: rgba(38,40,40,0.92);
        --text: rgba(245,245,245,1);
        --muted: rgba(167,169,169,0.75);
        --border: rgba(167,169,169,0.20);
        --sh1: 0 12px 34px rgba(0,0,0,0.35);
        --sh2: 0 2px 10px rgba(0,0,0,0.30);
        --ring: 0 0 0 3px rgba(74,222,128,0.14);
      }
    }

    *{ margin:0; padding:0; box-sizing:border-box; }
    html, body{ height:100%; }
    body{
      font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
      background:
        radial-gradient(1200px 800px at 10% -10%, rgba(33,128,141,0.16), transparent 55%),
        radial-gradient(1000px 700px at 95% 10%, rgba(168,85,247,0.14), transparent 55%),
        radial-gradient(900px 650px at 45% 110%, rgba(249,115,22,0.12), transparent 55%),
        var(--bg);
      color: var(--text);
      padding-bottom: calc(var(--navH) + 18px);
      overflow-x:hidden;
      -webkit-tap-highlight-color: transparent;
    }

    /* NORIAN watermark */
    body::before{
      content:"NORIAN";
      position: fixed;
      inset: 0;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight: 900;
      letter-spacing: 0.22em;
      font-size: min(18vw, 140px);
      color: rgba(33,128,141,0.08);
      text-shadow: 0 10px 30px rgba(0,0,0,0.06);
      pointer-events:none;
      z-index: 0;
      transform: translateY(-6px);
      user-select:none;
    }
    @media (prefers-color-scheme: dark){
      body::before{
        color: rgba(74,222,128,0.07);
        text-shadow: 0 10px 26px rgba(0,0,0,0.35);
      }
    }

    .app{
      position: relative;
      z-index: 1;
    }

    /* Header */
    .header{
      position: sticky;
      top:0;
      z-index: 120;
      padding: var(--s16) var(--s18);
      background: linear-gradient(180deg, var(--surface2), var(--surface));
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      border-bottom: 1px solid var(--border);
      box-shadow: var(--sh2);
    }
    .header-top{
      display:flex;
      align-items:flex-start;
      justify-content: space-between;
      gap: var(--s12);
    }
    .brand{
      display:flex;
      flex-direction: column;
      gap: 6px;
      min-width: 0;
    }
    .brand h1{
      font-size: 22px;
      font-weight: 800;
      letter-spacing: -0.02em;
      line-height: 1.1;
      color: var(--teal);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .brand .sub{
      font-size: 12px;
      color: var(--muted);
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: var(--rfull);
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.22);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    @media (prefers-color-scheme: dark){
      .pill{ background: rgba(255,255,255,0.06); }
    }

    .header-actions{
      display:flex;
      gap: 10px;
      align-items:center;
      flex-shrink: 0;
    }
    .icon-btn{
      width: 42px;
      height: 42px;
      border-radius: var(--r12);
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.22);
      display:flex;
      align-items:center;
      justify-content:center;
      box-shadow: var(--sh2);
      cursor:pointer;
      user-select:none;
    }
    .icon-btn:active{ transform: scale(0.98); box-shadow:none; }
    .icon-btn span{ font-size: 18px; }

    /* Quick actions */
    .quick-wrap{
      padding: var(--s14) var(--s16) 0;
    }
    .quick-actions{
      display:grid;
      grid-template-columns: repeat(2, 1fr);
      gap: var(--s12);
    }
    .quick-btn{
      background: linear-gradient(180deg, rgba(255,255,255,0.88), rgba(255,255,255,0.70));
      border: 1px solid var(--border);
      border-radius: var(--r20);
      padding: var(--s16);
      display:flex;
      gap: 12px;
      align-items: center;
      cursor:pointer;
      box-shadow: var(--sh1);
      user-select:none;
      min-height: 74px;
    }
    @media (prefers-color-scheme: dark){
      .quick-btn{
        background: linear-gradient(180deg, rgba(38,40,40,0.92), rgba(38,40,40,0.72));
      }
    }
    .quick-btn:active{ transform: scale(0.985); box-shadow:none; }

    .q-left{
      width: 44px;
      height: 44px;
      border-radius: 14px;
      display:flex;
      align-items:center;
      justify-content:center;
      flex-shrink: 0;
      border: 1px solid rgba(255,255,255,0.18);
      box-shadow: 0 6px 16px rgba(0,0,0,0.06);
    }
    .q-left span{ font-size: 22px; line-height: 1; }

    .q-mid{
      min-width: 0;
      flex: 1;
      display:flex;
      flex-direction: column;
      gap: 4px;
    }
    .q-title{
      font-size: 13px;
      font-weight: 800;
      letter-spacing: 0.01em;
      line-height: 1.1;
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis; /* FIX: da se ne re≈æe ru≈æno */
    }
    .q-sub{
      font-size: 12px;
      color: var(--muted);
      line-height: 1.2;
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }
    .q-right{
      font-size: 11px;
      color: var(--muted);
      white-space: nowrap;
      margin-left: 8px;
      flex-shrink: 0;
    }

    .sleep .q-left{ background: rgba(192,132,252,0.18); color: var(--purple); }
    .feeding .q-left{ background: rgba(236,72,153,0.16); color: var(--pink); }
    .diaper .q-left{ background: rgba(96,165,250,0.16); color: var(--blue); }
    .bath .q-left{ background: rgba(33,128,141,0.14); color: var(--teal); }
    .medicine .q-left{ background: rgba(251,146,60,0.14); color: var(--orange); }
    .colic .q-left{ background: rgba(251,146,60,0.14); color: var(--orange); }

    /* Sections */
    .section{
      margin: var(--s16);
      padding: var(--s16);
      border-radius: var(--r20);
      background: linear-gradient(180deg, rgba(255,255,255,0.88), rgba(255,255,255,0.72));
      border: 1px solid var(--border);
      box-shadow: var(--sh1);
    }
    @media (prefers-color-scheme: dark){
      .section{
        background: linear-gradient(180deg, rgba(38,40,40,0.92), rgba(38,40,40,0.72));
      }
    }

    .section-header{
      display:flex;
      justify-content: space-between;
      align-items:center;
      margin-bottom: var(--s14);
      gap: 12px;
    }
    .section-title{
      font-size: 16px;
      font-weight: 900;
      letter-spacing: -0.01em;
    }
    .view-all{
      font-size: 13px;
      color: var(--teal);
      cursor:pointer;
      text-decoration:none;
      font-weight: 700;
      user-select:none;
    }

    /* Activity cards */
    .activity-list{
      display:flex;
      flex-direction: column;
      gap: 10px;
    }

    .activity-item{
      display:flex;
      gap: 12px;
      padding: 12px;
      border-radius: 16px;
      background: rgba(255,255,255,0.26);
      border: 1px solid var(--border);
      align-items: flex-start;
    }
    @media (prefers-color-scheme: dark){
      .activity-item{ background: rgba(255,255,255,0.06); }
    }

    .activity-icon{
      width: 44px;
      height: 44px;
      border-radius: 14px;
      display:flex;
      align-items:center;
      justify-content:center;
      flex-shrink:0;
      border: 1px solid rgba(255,255,255,0.14);
    }
    .activity-icon span{ font-size: 22px; }

    .activity-content{
      flex:1;
      min-width:0;
    }
    .activity-title{
      font-weight: 900;
      font-size: 13px;
      margin-bottom: 3px;
      line-height: 1.15;
    }
    .activity-details{
      font-size: 12px;
      color: var(--muted);
      line-height: 1.35;
      overflow-wrap: anywhere;
    }
    .activity-time{
      font-size: 11px;
      color: var(--muted);
      white-space: nowrap;
      margin-left: 6px;
      flex-shrink: 0;
    }

    /* Grouped history */
    .day-group{
      margin-top: 10px;
      border: 1px solid var(--border);
      border-radius: 16px;
      overflow: hidden;
      background: rgba(255,255,255,0.18);
    }
    @media (prefers-color-scheme: dark){
      .day-group{ background: rgba(255,255,255,0.05); }
    }
    .day-header{
      padding: 10px 12px;
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 12px;
      background: linear-gradient(180deg, rgba(33,128,141,0.10), rgba(33,128,141,0.03));
      border-bottom: 1px solid var(--border);
      position: sticky;
      top: 74px; /* ispod header-a */
      z-index: 10;
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
    }
    .day-title{
      font-weight: 900;
      font-size: 13px;
      color: var(--text);
    }
    .day-meta{
      font-size: 11px;
      color: var(--muted);
      white-space: nowrap;
    }
    .day-body{
      padding: 10px;
      display:flex;
      flex-direction: column;
      gap: 10px;
    }

    /* Dnevna statistika (kompaktnije) */
    .stats-grid{
      display:grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
    }
    .stat-card{
      padding: 12px;
      border-radius: 16px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.20);
    }
    @media (prefers-color-scheme: dark){
      .stat-card{ background: rgba(255,255,255,0.06); }
    }
    .stat-value{
      font-size: 22px;
      font-weight: 900;
      color: var(--teal);
      margin-bottom: 3px;
      letter-spacing: -0.02em;
    }
    .stat-label{
      font-size: 11px;
      color: var(--muted);
    }

    /* Empty */
    .empty-state{
      text-align:center;
      padding: 18px 10px;
      color: var(--muted);
      font-size: 13px;
    }

    /* Modal */
    .modal{
      display:none;
      position: fixed;
      inset:0;
      background: rgba(0,0,0,0.55);
      z-index: 1000;
      animation: fadeIn .18s ease-out;
    }
    .modal.active{
      display:flex;
      align-items:flex-end;
    }
    @keyframes fadeIn{ from{opacity:0} to{opacity:1} }
    @keyframes slideUp{ from{ transform: translateY(100%)} to{ transform: translateY(0)} }

    .modal-content{
      width: 100%;
      max-height: 85vh;
      border-radius: 22px 22px 0 0;
      padding: var(--s20);
      animation: slideUp .25s ease-out;
      overflow-y:auto;
      background: linear-gradient(180deg, var(--surface2), var(--surface));
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border-top: 1px solid var(--border);
      box-shadow: 0 -20px 50px rgba(0,0,0,0.20);
    }

    .modal-header{
      display:flex;
      justify-content: space-between;
      align-items:center;
      gap: 12px;
      margin-bottom: var(--s18);
    }
    .modal-title{
      font-size: 18px;
      font-weight: 900;
      letter-spacing: -0.01em;
    }
    .close-btn{
      font-size: 28px;
      cursor:pointer;
      color: var(--muted);
      line-height:1;
      user-select:none;
    }

    .form-group{ margin-bottom: 14px; }
    .form-label{
      display:block;
      font-size: 13px;
      font-weight: 800;
      margin-bottom: 8px;
      color: var(--text);
    }
    .form-input, .form-select, .form-textarea{
      width: 100%;
      padding: 12px 12px;
      border: 1px solid var(--border);
      border-radius: 14px;
      font-size: 15px;
      background: rgba(255,255,255,0.18);
      color: var(--text);
    }
    @media (prefers-color-scheme: dark){
      .form-input, .form-select, .form-textarea{ background: rgba(255,255,255,0.06); }
    }
    .form-textarea{
      min-height: 84px;
      resize: vertical;
      font-family: inherit;
    }
    .form-input:focus, .form-select:focus, .form-textarea:focus{
      outline:none;
      box-shadow: var(--ring);
      border-color: rgba(33,128,141,0.45);
    }

    .button-group{
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 12px;
    }
    .toggle-btn{
      flex: 1;
      min-width: 110px;
      padding: 12px 12px;
      border: 1px solid var(--border);
      border-radius: 14px;
      background: rgba(255,255,255,0.16);
      cursor:pointer;
      font-size: 13px;
      font-weight: 900;
      transition: all .16s ease;
      user-select:none;
      color: var(--text);
    }
    @media (prefers-color-scheme: dark){
      .toggle-btn{ background: rgba(255,255,255,0.06); }
    }
    .toggle-btn.active{
      background: rgba(33,128,141,0.95);
      color: #fff;
      border-color: rgba(33,128,141,0.95);
      box-shadow: 0 10px 20px rgba(33,128,141,0.18);
    }

    .submit-btn{
      width: 100%;
      padding: 14px 14px;
      background: rgba(33,128,141,1);
      color: #fff;
      border:none;
      border-radius: 16px;
      font-size: 15px;
      font-weight: 1000;
      cursor:pointer;
      transition: all .18s ease;
      user-select:none;
      box-shadow: 0 14px 30px rgba(33,128,141,0.18);
    }
    .submit-btn:active{ transform: scale(0.985); filter: brightness(0.96); box-shadow:none; }

    .timer-display{
      text-align:center;
      padding: 18px 14px;
      border-radius: 18px;
      margin-bottom: 14px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.18);
    }
    @media (prefers-color-scheme: dark){
      .timer-display{ background: rgba(255,255,255,0.06); }
    }
    .timer-text{
      font-size: 44px;
      font-weight: 1000;
      color: var(--teal);
      font-variant-numeric: tabular-nums;
      letter-spacing: -0.02em;
    }
    .timer-label{
      font-size: 12px;
      color: var(--muted);
      margin-top: 6px;
    }

    /* Reminders */
    .reminders-list{
      display:flex;
      flex-direction: column;
      gap: 10px;
    }
    .reminder-item{
      border: 1px solid rgba(33,128,141,0.35);
      border-radius: 16px;
      padding: 12px;
      display:flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      background: rgba(var(--teal-rgb), 0.10);
    }
    .reminder-content{ flex: 1; min-width: 0; }
    .reminder-title{ font-weight: 1000; font-size: 13px; margin-bottom: 4px; }
    .reminder-time{ font-size: 12px; color: var(--muted); line-height: 1.35; }
    .delete-btn{
      color: var(--orange);
      font-size: 20px;
      cursor:pointer;
      padding: 8px;
      user-select:none;
      border-radius: 12px;
      border: 1px solid rgba(249,115,22,0.35);
      background: rgba(249,115,22,0.10);
    }
    .delete-btn:active{ transform: scale(0.98); }

    /* Bottom nav */
    .bottom-nav{
      position: fixed;
      left: 0; right: 0; bottom: 0;
      height: var(--navH);
      display:flex;
      justify-content: space-around;
      align-items: center;
      padding: 10px 10px calc(10px + env(safe-area-inset-bottom));
      background: linear-gradient(180deg, var(--surface), var(--surface2));
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      border-top: 1px solid var(--border);
      box-shadow: 0 -12px 36px rgba(0,0,0,0.10);
      z-index: 220;
    }
    .nav-item{
      width: 25%;
      display:flex;
      flex-direction: column;
      align-items:center;
      justify-content:center;
      gap: 4px;
      cursor:pointer;
      color: var(--muted);
      transition: all .16s ease;
      padding: 10px 6px;
      border-radius: 18px;
      user-select:none;
      position: relative;
    }
    .nav-item.active{
      color: var(--teal);
      background: rgba(33,128,141,0.10);
      border: 1px solid rgba(33,128,141,0.25);
    }
    .nav-icon{ font-size: 22px; line-height: 1; }
    .nav-label{ font-size: 10.5px; font-weight: 900; }

    .notification-badge{
      position: absolute;
      top: 7px;
      right: 20px;
      background: rgba(249,115,22,1);
      color: #fff;
      border-radius: var(--rfull);
      min-width: 18px;
      height: 18px;
      padding: 0 6px;
      font-size: 10px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight: 1000;
      line-height: 1;
      border: 1px solid rgba(255,255,255,0.35);
      box-shadow: 0 10px 22px rgba(0,0,0,0.14);
    }

    /* Pages */
    .page{ display:none; }
    .page.active{ display:block; }
  </style>
</head>

<body>
  <div class="app">
    <!-- Poƒçetna -->
    <div id="homePage" class="page active">
      <div class="header">
        <div class="header-top">
          <div class="brand">
            <h1>üë∂ Nori Tracker</h1>
            <div class="sub">
              <span class="pill">üåô San: <strong id="lastSleepTime">-</strong></span>
              <span class="pill">üçº Hranjenje: <strong id="lastFeedingTime">-</strong></span>
            </div>
          </div>
          <div class="header-actions">
            <div class="icon-btn" onclick="switchPage('history')" title="Historija"><span>üìä</span></div>
            <div class="icon-btn" onclick="switchPage('reminders')" title="Podsjetnici"><span>üîî</span></div>
          </div>
        </div>
      </div>

      <div class="quick-wrap">
        <div class="quick-actions">
          <div class="quick-btn sleep" onclick="openModal('sleep')">
            <div class="q-left"><span>üò¥</span></div>
            <div class="q-mid">
              <div class="q-title">San</div>
              <div class="q-sub" id="sleepLastTime">-</div>
            </div>
            <div class="q-right" id="sleepRight"> </div>
          </div>

          <div class="quick-btn feeding" onclick="openModal('feeding')">
            <div class="q-left"><span>üçº</span></div>
            <div class="q-mid">
              <div class="q-title">Hranjenje</div>
              <div class="q-sub" id="feedingLastTime">-</div>
            </div>
            <div class="q-right" id="feedingRight"> </div>
          </div>

          <div class="quick-btn diaper" onclick="openModal('diaper')">
            <div class="q-left"><span>üë∂</span></div>
            <div class="q-mid">
              <div class="q-title">Pelena</div>
              <div class="q-sub" id="diaperLastTime">-</div>
            </div>
            <div class="q-right"> </div>
          </div>

          <div class="quick-btn bath" onclick="openModal('bath')">
            <div class="q-left"><span>üõÅ</span></div>
            <div class="q-mid">
              <div class="q-title">Kupanje</div>
              <div class="q-sub" id="bathLastTime">-</div>
            </div>
            <div class="q-right"> </div>
          </div>

          <div class="quick-btn medicine" onclick="openModal('medicine')">
            <div class="q-left"><span>üíä</span></div>
            <div class="q-mid">
              <div class="q-title">Lijekovi</div>
              <div class="q-sub" id="medicineLastTime">-</div>
            </div>
            <div class="q-right"> </div>
          </div>

          <div class="quick-btn colic" onclick="openModal('colic')">
            <div class="q-left"><span>üò£</span></div>
            <div class="q-mid">
              <div class="q-title">Grƒçevi</div>
              <div class="q-sub" id="colicLastTime">-</div>
            </div>
            <div class="q-right"> </div>
          </div>
        </div>
      </div>

      <div class="section">
        <div class="section-header">
          <h2 class="section-title">Trenutno / posljednje</h2>
          <a class="view-all" onclick="switchPage('history')">Historija</a>
        </div>
        <div id="homeNowActivities" class="activity-list"></div>
      </div>

      <div class="section">
        <div class="section-header">
          <h2 class="section-title">Danas (brzi pregled)</h2>
        </div>
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-value" id="todaySleepCount">0</div>
            <div class="stat-label">Spavanja</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="todayFeedingCount">0</div>
            <div class="stat-label">Hranjenja</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="todayDiaperCount">0</div>
            <div class="stat-label">Pelene</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="todayTotalSleep">0h</div>
            <div class="stat-label">Ukupno sna</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Historija -->
    <div id="historyPage" class="page">
      <div class="header">
        <div class="header-top">
          <div class="brand">
            <h1>üìä Historija</h1>
            <div class="sub">
              <span class="pill">Sortirano po danima ‚Ä¢ Najnovije prvo</span>
            </div>
          </div>
          <div class="header-actions">
            <div class="icon-btn" onclick="switchPage('home')" title="Poƒçetna"><span>üè†</span></div>
          </div>
        </div>
      </div>
      <div class="section">
        <div id="allActivities" class="activity-list"></div>
      </div>
    </div>

    <!-- Kontrole -->
    <div id="checkupPage" class="page">
      <div class="header">
        <div class="header-top">
          <div class="brand">
            <h1>üè• Kontrole</h1>
            <div class="sub"><span class="pill">Pregled i evidencija</span></div>
          </div>
          <div class="header-actions">
            <div class="icon-btn" onclick="switchPage('home')" title="Poƒçetna"><span>üè†</span></div>
          </div>
        </div>
      </div>
      <div class="section">
        <button class="submit-btn" onclick="openModal('checkup')" style="background: rgba(34,197,94,1); box-shadow: 0 14px 30px rgba(34,197,94,0.18);">+ Dodaj kontrolu</button>
        <div style="height: 12px;"></div>
        <div id="checkupList" class="activity-list"></div>
      </div>
    </div>

    <!-- Podsjetnici -->
    <div id="remindersPage" class="page">
      <div class="header">
        <div class="header-top">
          <div class="brand">
            <h1>üîî Podsjetnici</h1>
            <div class="sub"><span class="pill">Notifikacije + lista</span></div>
          </div>
          <div class="header-actions">
            <div class="icon-btn" onclick="switchPage('home')" title="Poƒçetna"><span>üè†</span></div>
          </div>
        </div>
      </div>
      <div class="section">
        <button class="submit-btn" onclick="openModal('reminder')" style="background: rgba(249,115,22,1); box-shadow: 0 14px 30px rgba(249,115,22,0.18);">+ Dodaj podsjetnik</button>
        <div style="height: 12px;"></div>
        <div id="remindersList" class="reminders-list"></div>
      </div>
    </div>

    <!-- Modal: San -->
    <div id="sleepModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title">üò¥ San</h2>
          <span class="close-btn" onclick="closeModal('sleep')">&times;</span>
        </div>

        <div id="sleepTimer" class="timer-display" style="display:none;">
          <div class="timer-text" id="sleepTimerText">00:00:00</div>
          <div class="timer-label" id="sleepTimerLabel">Vrijeme spavanja</div>
        </div>

        <div class="form-group" id="sleepStartGroup">
          <label class="form-label">Poƒçetak spavanja</label>
          <input type="datetime-local" id="sleepStartTime" class="form-input">
        </div>

        <div class="form-group" id="sleepEndGroup" style="display:none;">
          <label class="form-label">Buƒëenje</label>
          <input type="datetime-local" id="sleepEndTime" class="form-input">
        </div>

        <div class="form-group">
          <label class="form-label">Bilje≈°ke</label>
          <textarea id="sleepNotes" class="form-textarea" placeholder="Dodatne bilje≈°ke..."></textarea>
        </div>

        <button class="submit-btn" id="sleepStartBtn" onclick="startSleep()" style="background: rgba(168,85,247,1); box-shadow: 0 14px 30px rgba(168,85,247,0.18);">üõèÔ∏è Dijete zaspalo</button>
        <button class="submit-btn" id="sleepWakeBtn" onclick="wakeSleep()" style="display:none; background: rgba(249,115,22,1); box-shadow: 0 14px 30px rgba(249,115,22,0.18);">‚òÄÔ∏è Dijete se probudilo</button>
      </div>
    </div>

    <!-- Modal: Hranjenje -->
    <div id="feedingModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title">üçº Hranjenje</h2>
          <span class="close-btn" onclick="closeModal('feeding')">&times;</span>
        </div>

        <div id="feedingInfo" class="timer-display" style="display:none;">
          <div class="timer-label" id="feedingInfoLabel">-</div>
        </div>

        <div class="form-group" id="feedingStartGroup">
          <label class="form-label">Poƒçetak hranjenja</label>
          <input type="datetime-local" id="feedingStartTime" class="form-input">
        </div>

        <div class="form-group" id="feedingEndGroup" style="display:none;">
          <label class="form-label">Kraj hranjenja</label>
          <input type="datetime-local" id="feedingEndTime" class="form-input">
        </div>

        <div class="form-group">
          <label class="form-label">Dojka</label>
          <div class="button-group" id="breastButtons">
            <button class="toggle-btn" data-value="left" onclick="selectBreast(this)">Lijeva</button>
            <button class="toggle-btn" data-value="right" onclick="selectBreast(this)">Desna</button>
            <button class="toggle-btn" data-value="both" onclick="selectBreast(this)">Obje</button>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Bilje≈°ke (opciono)</label>
          <textarea id="feedingNotes" class="form-textarea" placeholder="Dodatne bilje≈°ke..."></textarea>
        </div>

        <div class="form-group">
          <label class="form-label">
            <input type="checkbox" id="feedingReminderCheck" style="margin-right: 8px;">
            Postavi podsjetnik za sljedeƒáe hranjenje
          </label>
        </div>

        <div class="form-group" id="feedingReminderGroup" style="display:none;">
          <label class="form-label">Za koliko sati?</label>
          <div class="button-group">
            <button type="button" class="toggle-btn" data-value="1.5" onclick="selectFeedingReminderHours(this)">1.5h</button>
            <button type="button" class="toggle-btn" data-value="2" onclick="selectFeedingReminderHours(this)">2h</button>
            <button type="button" class="toggle-btn" data-value="2.5" onclick="selectFeedingReminderHours(this)">2.5h</button>
            <button type="button" class="toggle-btn" data-value="3" onclick="selectFeedingReminderHours(this)">3h</button>
          </div>
        </div>

        <button class="submit-btn" id="feedingStartBtn" onclick="startFeeding()" style="background: rgba(219,39,119,1); box-shadow: 0 14px 30px rgba(219,39,119,0.18);">üçº Poƒçinje jesti</button>
        <button class="submit-btn" id="feedingEndBtn" onclick="endFeeding()" style="display:none; background: rgba(34,197,94,1); box-shadow: 0 14px 30px rgba(34,197,94,0.18);">‚úì Zavr≈°io jesti</button>
      </div>
    </div>

    <!-- Modal: Pelena -->
    <div id="diaperModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title">üë∂ Pelena</h2>
          <span class="close-btn" onclick="closeModal('diaper')">&times;</span>
        </div>

        <div class="form-group">
          <label class="form-label">Vrijeme</label>
          <input type="datetime-local" id="diaperTime" class="form-input">
        </div>

        <div class="form-group">
          <label class="form-label">Tip</label>
          <div class="button-group" id="diaperButtons">
            <button class="toggle-btn" data-value="wet" onclick="selectDiaperType(this)">üíß Mokra</button>
            <button class="toggle-btn" data-value="dirty" onclick="selectDiaperType(this)">üí© Prljava</button>
            <button class="toggle-btn" data-value="both" onclick="selectDiaperType(this)">Oboje</button>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Bilje≈°ke</label>
          <textarea id="diaperNotes" class="form-textarea" placeholder="Dodatne bilje≈°ke..."></textarea>
        </div>

        <button class="submit-btn" onclick="saveDiaper()" style="background: rgba(59,130,246,1); box-shadow: 0 14px 30px rgba(59,130,246,0.18);">Spremi</button>
      </div>
    </div>

    <!-- Modal: Kupanje -->
    <div id="bathModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title">üõÅ Kupanje</h2>
          <span class="close-btn" onclick="closeModal('bath')">&times;</span>
        </div>

        <div class="form-group">
          <label class="form-label">Vrijeme</label>
          <input type="datetime-local" id="bathTime" class="form-input">
        </div>

        <div class="form-group">
          <label class="form-label">Temperatura vode</label>
          <input type="text" id="bathTemp" class="form-input" placeholder="npr. 37¬∞C">
        </div>

        <div class="form-group">
          <label class="form-label">Bilje≈°ke</label>
          <textarea id="bathNotes" class="form-textarea" placeholder="Dodatne bilje≈°ke..."></textarea>
        </div>

        <button class="submit-btn" onclick="saveBath()" style="background: rgba(33,128,141,1); box-shadow: 0 14px 30px rgba(33,128,141,0.18);">Spremi</button>
      </div>
    </div>

    <!-- Modal: Lijekovi -->
    <div id="medicineModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title">üíä Lijekovi/Kapi</h2>
          <span class="close-btn" onclick="closeModal('medicine')">&times;</span>
        </div>

        <div class="form-group">
          <label class="form-label">Vrijeme</label>
          <input type="datetime-local" id="medicineTime" class="form-input">
        </div>

        <div class="form-group">
          <label class="form-label">Naziv lijeka/kapi</label>
          <input type="text" id="medicineName" class="form-input" placeholder="npr. Espumisan kapi">
        </div>

        <div class="form-group">
          <label class="form-label">Doza</label>
          <input type="text" id="medicineDose" class="form-input" placeholder="npr. 10 kapi">
        </div>

        <div class="form-group">
          <label class="form-label">Bilje≈°ke</label>
          <textarea id="medicineNotes" class="form-textarea" placeholder="Dodatne bilje≈°ke..."></textarea>
        </div>

        <button class="submit-btn" onclick="saveMedicine()" style="background: rgba(249,115,22,1); box-shadow: 0 14px 30px rgba(249,115,22,0.18);">Spremi</button>
      </div>
    </div>

    <!-- Modal: Grƒçevi -->
    <div id="colicModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title">üò£ Grƒçevi</h2>
          <span class="close-btn" onclick="closeModal('colic')">&times;</span>
        </div>

        <div id="colicTimer" class="timer-display" style="display:none;">
          <div class="timer-text" id="colicTimerText">00:00:00</div>
          <div class="timer-label">Trajanje grƒçeva</div>
        </div>

        <div class="form-group">
          <label class="form-label">Poƒçetak</label>
          <input type="datetime-local" id="colicStartTime" class="form-input">
        </div>

        <div class="form-group">
          <label class="form-label">Trajanje (minute)</label>
          <input type="number" id="colicDuration" class="form-input" min="1" placeholder="npr. 30">
        </div>

        <div class="form-group">
          <label class="form-label">Intenzitet</label>
          <div class="button-group" id="intensityButtons">
            <button class="toggle-btn" data-value="mild" onclick="selectIntensity(this)">Blago</button>
            <button class="toggle-btn" data-value="moderate" onclick="selectIntensity(this)">Umjereno</button>
            <button class="toggle-btn" data-value="severe" onclick="selectIntensity(this)">Jako</button>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Bilje≈°ke</label>
          <textarea id="colicNotes" class="form-textarea" placeholder="≈†to je pomoglo..."></textarea>
        </div>

        <button class="submit-btn" id="colicStartBtn" onclick="startColicTimer()" style="background: rgba(249,115,22,1); box-shadow: 0 14px 30px rgba(249,115,22,0.18);">Pokreni tajmer</button>
        <button class="submit-btn" id="colicStopBtn" onclick="stopColicTimer()" style="display:none; background: rgba(34,197,94,1); box-shadow: 0 14px 30px rgba(34,197,94,0.18);">Zaustavi tajmer</button>

        <div style="height: 10px;"></div>
        <button class="submit-btn" id="colicSubmitBtn" onclick="saveColic()" style="background: rgba(33,128,141,1); box-shadow: 0 14px 30px rgba(33,128,141,0.18);">Spremi</button>
      </div>
    </div>

    <!-- Modal: Kontrola -->
    <div id="checkupModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title">üè• Kontrola</h2>
          <span class="close-btn" onclick="closeModal('checkup')">&times;</span>
        </div>

        <div class="form-group">
          <label class="form-label">Datum i vrijeme kontrole</label>
          <input type="datetime-local" id="checkupTime" class="form-input">
        </div>

        <div class="form-group">
          <label class="form-label">Doktor/Klinika</label>
          <input type="text" id="checkupDoctor" class="form-input" placeholder="npr. Dr. Horvat">
        </div>

        <div class="form-group">
          <label class="form-label">Te≈æina (kg)</label>
          <input type="number" id="checkupWeight" class="form-input" step="0.1" placeholder="npr. 4.5">
        </div>

        <div class="form-group">
          <label class="form-label">Visina (cm)</label>
          <input type="number" id="checkupHeight" class="form-input" step="0.5" placeholder="npr. 55">
        </div>

        <div class="form-group">
          <label class="form-label">Bilje≈°ke</label>
          <textarea id="checkupNotes" class="form-textarea" placeholder="Nalazi, preporuke..."></textarea>
        </div>

        <button class="submit-btn" onclick="saveCheckup()" style="background: rgba(34,197,94,1); box-shadow: 0 14px 30px rgba(34,197,94,0.18);">Spremi</button>
      </div>
    </div>

    <!-- Modal: Podsjetnik -->
    <div id="reminderModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title">üîî Podsjetnik</h2>
          <span class="close-btn" onclick="closeModal('reminder')">&times;</span>
        </div>

        <div class="form-group">
          <label class="form-label">Naslov</label>
          <input type="text" id="reminderTitle" class="form-input" placeholder="npr. Vakcinacija">
        </div>

        <div class="form-group">
          <label class="form-label">Datum i vrijeme</label>
          <input type="datetime-local" id="reminderTime" class="form-input">
        </div>

        <div class="form-group">
          <label class="form-label">Opis</label>
          <textarea id="reminderDesc" class="form-textarea" placeholder="Detalji..."></textarea>
        </div>

        <button class="submit-btn" onclick="saveReminder()" style="background: rgba(249,115,22,1); box-shadow: 0 14px 30px rgba(249,115,22,0.18);">Spremi</button>
      </div>
    </div>

    <!-- Bottom Navigation -->
    <div class="bottom-nav">
      <div class="nav-item active" data-page="home" onclick="switchPage('home')">
        <div class="nav-icon">üè†</div>
        <div class="nav-label">Poƒçetna</div>
      </div>
      <div class="nav-item" data-page="history" onclick="switchPage('history')">
        <div class="nav-icon">üìä</div>
        <div class="nav-label">Historija</div>
      </div>
      <div class="nav-item" data-page="checkup" onclick="switchPage('checkup')">
        <div class="nav-icon">üè•</div>
        <div class="nav-label">Kontrole</div>
      </div>
      <div class="nav-item" data-page="reminders" onclick="switchPage('reminders')">
        <div class="nav-icon" style="position: relative;">
          üîî
          <span id="reminderBadge" class="notification-badge" style="display:none;">0</span>
        </div>
        <div class="nav-label">Podsjetnici</div>
      </div>
    </div>
  </div>

  <script>
    // -----------------------------
    // PODESAVANJA / POMOCNE FUNKCIJE
    // -----------------------------
    const TZ = "Europe/Sarajevo";

    function getTZParts(date = new Date(), timeZone = TZ) {
      const dtf = new Intl.DateTimeFormat("en-GB", {
        timeZone,
        year: "numeric",
        month: "2-digit",
        day: "2-digit",
        hour: "2-digit",
        minute: "2-digit",
        second: "2-digit",
        hour12: false
      });
      const parts = dtf.formatToParts(date);
      const map = {};
      parts.forEach(p => { if (p.type !== "literal") map[p.type] = p.value; });
      return map;
    }

    function nowISOInTZ() {
      const p = getTZParts(new Date(), TZ);
      const localLike = new Date(`${p.year}-${p.month}-${p.day}T${p.hour}:${p.minute}:${p.second}`);
      return localLike.toISOString();
    }

    function valueForDatetimeLocalNow() {
      const p = getTZParts(new Date(), TZ);
      return `${p.year}-${p.month}-${p.day}T${p.hour}:${p.minute}`;
    }

    function pad2(n){ return String(n).padStart(2,"0"); }

    function hmsFromMs(ms) {
      const total = Math.max(0, Math.floor(ms / 1000));
      const h = Math.floor(total / 3600);
      const m = Math.floor((total % 3600) / 60);
      const s = total % 60;
      return `${pad2(h)}:${pad2(m)}:${pad2(s)}`;
    }

    function escapeHtml(str) {
      return String(str || "")
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    function formatTime(iso) {
      const d = new Date(iso);
      const dd = String(d.getDate()).padStart(2,"0");
      const mm = String(d.getMonth() + 1).padStart(2,"0");
      const yy = d.getFullYear();
      const hh = String(d.getHours()).padStart(2, "0");
      const mi = String(d.getMinutes()).padStart(2, "0");

      const today = new Date(); today.setHours(0,0,0,0);
      const yesterday = new Date(today); yesterday.setDate(yesterday.getDate() - 1);
      const d0 = new Date(d); d0.setHours(0,0,0,0);

      if (d0.getTime() === today.getTime()) return `Danas ${hh}:${mi}`;
      if (d0.getTime() === yesterday.getTime()) return `Juƒçer ${hh}:${mi}`;
      return `${dd}.${mm}.${yy} ${hh}:${mi}`;
    }

    function formatTimeAgo(iso) {
      const now = Date.now();
      const then = new Date(iso).getTime();
      const diff = now - then;
      const minutes = Math.floor(diff / 60000);
      const hours = Math.floor(minutes / 60);
      const days = Math.floor(hours / 24);

      if (minutes < 1) return "upravo";
      if (minutes < 60) return `Prije ${minutes} min`;
      if (hours < 24) return `Prije ${hours}h`;
      return `Prije ${days} dana`;
    }

    function dayKey(iso){
      const d = new Date(iso);
      const y = d.getFullYear();
      const m = String(d.getMonth()+1).padStart(2,"0");
      const da = String(d.getDate()).padStart(2,"0");
      return `${y}-${m}-${da}`;
    }

    function dayLabelFromKey(key){
      const [y,m,d] = key.split("-");
      const dt = new Date(`${y}-${m}-${d}T00:00:00`);
      const today = new Date(); today.setHours(0,0,0,0);
      const yesterday = new Date(today); yesterday.setDate(yesterday.getDate()-1);

      if (dt.getTime() === today.getTime()) return "Danas";
      if (dt.getTime() === yesterday.getTime()) return "Juƒçer";
      return `${d}.${m}.${y}`;
    }

    // -----------------------------
    // STORAGE (NE MIJENJAJ KLJUƒåEVE -> NE GUBI≈† STARE PODATKE)
    // -----------------------------
    let activities = JSON.parse(localStorage.getItem("babyActivities") || "[]");
    let checkups = JSON.parse(localStorage.getItem("babyCheckups") || "[]");
    let reminders = JSON.parse(localStorage.getItem("babyReminders") || "[]");

    // Aktivni procesi
    let activeSleep = JSON.parse(localStorage.getItem("activeSleep") || "null");     // {startIso, startMs, startDisplay}
    let activeFeeding = JSON.parse(localStorage.getItem("activeFeeding") || "null"); // {startIso, startDisplay, startMs, breast}

    // UI selections
    let selectedBreast = null;
    let selectedDiaperType = null;
    let selectedIntensity = null;
    let selectedFeedingReminderHours = null;

    // Timers
    let sleepInterval = null;
    let colicInterval = null;
    let colicStartMs = null;

    // -----------------------------
    // MODALI
    // -----------------------------
    function openModal(type) {
      const modal = document.getElementById(type + "Modal");
      if (!modal) return;
      modal.classList.add("active");

      const map = {
        sleep: "sleepStartTime",
        feeding: "feedingStartTime",
        diaper: "diaperTime",
        bath: "bathTime",
        medicine: "medicineTime",
        colic: "colicStartTime",
        checkup: "checkupTime",
        reminder: "reminderTime"
      };

      if (map[type]) {
        const el = document.getElementById(map[type]);
        if (el && !el.value) el.value = valueForDatetimeLocalNow();
      }

      if (type === "sleep") {
        if (activeSleep) showActiveSleepUI();
        else resetSleepUI(false);
      }

      if (type === "feeding") {
        if (activeFeeding) showActiveFeedingUI();
        else resetFeedingUI(false);
      }

      if (type === "colic") {
        document.getElementById("colicTimer").style.display = "none";
        document.getElementById("colicStartBtn").style.display = "block";
        document.getElementById("colicStopBtn").style.display = "none";
      }
    }

    function closeModal(type) {
      const modal = document.getElementById(type + "Modal");
      if (!modal) return;
      modal.classList.remove("active");

      if (type === "sleep") {
        if (sleepInterval) { clearInterval(sleepInterval); sleepInterval = null; }
        document.getElementById("sleepNotes").value = "";
        if (activeSleep) showActiveSleepUI(); else resetSleepUI(true);
      }

      if (type === "feeding") {
        document.getElementById("feedingNotes").value = "";
        document.getElementById("feedingEndTime").value = "";
        if (activeFeeding) showActiveFeedingUI(); else resetFeedingUI(true);
      }

      if (type === "diaper") {
        document.getElementById("diaperNotes").value = "";
        document.querySelectorAll("#diaperButtons .toggle-btn").forEach(b => b.classList.remove("active"));
        selectedDiaperType = null;
      }

      if (type === "bath") {
        document.getElementById("bathTemp").value = "";
        document.getElementById("bathNotes").value = "";
      }

      if (type === "medicine") {
        document.getElementById("medicineName").value = "";
        document.getElementById("medicineDose").value = "";
        document.getElementById("medicineNotes").value = "";
      }

      if (type === "colic") {
        if (colicInterval) { clearInterval(colicInterval); colicInterval = null; }
        colicStartMs = null;
        document.getElementById("colicDuration").value = "";
        document.getElementById("colicNotes").value = "";
        document.querySelectorAll("#intensityButtons .toggle-btn").forEach(b => b.classList.remove("active"));
        selectedIntensity = null;
        document.getElementById("colicTimer").style.display = "none";
        document.getElementById("colicStartBtn").style.display = "block";
        document.getElementById("colicStopBtn").style.display = "none";
        document.getElementById("colicTimerText").textContent = "00:00:00";
      }

      if (type === "checkup") {
        document.getElementById("checkupDoctor").value = "";
        document.getElementById("checkupWeight").value = "";
        document.getElementById("checkupHeight").value = "";
        document.getElementById("checkupNotes").value = "";
      }

      if (type === "reminder") {
        document.getElementById("reminderTitle").value = "";
        document.getElementById("reminderDesc").value = "";
      }
    }

    // zatvori klikom izvan
    document.querySelectorAll(".modal").forEach(modal => {
      modal.addEventListener("click", (e) => {
        if (e.target === modal) {
          const type = modal.id.replace("Modal", "");
          closeModal(type);
        }
      });
    });

    // -----------------------------
    // SLEEP
    // -----------------------------
    function resetSleepUI(fullReset) {
      document.getElementById("sleepTimer").style.display = "none";
      document.getElementById("sleepStartBtn").style.display = "block";
      document.getElementById("sleepWakeBtn").style.display = "none";
      document.getElementById("sleepStartGroup").style.display = "block";
      document.getElementById("sleepEndGroup").style.display = "none";
      document.getElementById("sleepTimerText").textContent = "00:00:00";
      document.getElementById("sleepTimerLabel").textContent = "Vrijeme spavanja";
      if (fullReset) {
        document.getElementById("sleepStartTime").value = "";
        document.getElementById("sleepEndTime").value = "";
      }
    }

    function showActiveSleepUI() {
      resetSleepUI(false);
      document.getElementById("sleepTimer").style.display = "block";
      document.getElementById("sleepStartBtn").style.display = "none";
      document.getElementById("sleepWakeBtn").style.display = "block";
      document.getElementById("sleepStartGroup").style.display = "none";
      document.getElementById("sleepEndGroup").style.display = "none";

      if (sleepInterval) { clearInterval(sleepInterval); sleepInterval = null; }

      sleepInterval = setInterval(() => {
        const elapsed = Date.now() - activeSleep.startMs;
        document.getElementById("sleepTimerText").textContent = hmsFromMs(elapsed);
        document.getElementById("sleepTimerLabel").textContent = `Poƒçeo spavati u ${activeSleep.startDisplay}`;
      }, 500);

      const elapsed = Date.now() - activeSleep.startMs;
      document.getElementById("sleepTimerText").textContent = hmsFromMs(elapsed);
      document.getElementById("sleepTimerLabel").textContent = `Poƒçeo spavati u ${activeSleep.startDisplay}`;
    }

    function startSleep() {
      if (activeSleep) return;

      const manual = document.getElementById("sleepStartTime").value;
      let startDate;
      if (manual) startDate = new Date(manual);
      else startDate = new Date(nowISOInTZ());

      if (startDate.getTime() > Date.now() + 60000) {
        alert("Poƒçetak spavanja ne mo≈æe biti u buduƒánosti.");
        return;
      }

      const startIso = startDate.toISOString();
      const startDisplay = startDate.toLocaleString("bs-BA", { hour: "2-digit", minute: "2-digit" });

      activeSleep = { startIso, startMs: startDate.getTime(), startDisplay };
      localStorage.setItem("activeSleep", JSON.stringify(activeSleep));

      updateSleepQuickButton(true);
      closeModal("sleep");
      ensureHomeIntervals();
      updateDisplay();
    }

    function wakeSleep() {
      if (!activeSleep) return;

      const endDate = new Date(nowISOInTZ());
      const durationHours = (endDate.getTime() - activeSleep.startMs) / 3600000;

      if (durationHours <= 0) {
        alert("Gre≈°ka u vremenima!");
        return;
      }

      const notes = document.getElementById("sleepNotes").value || "";
      const endDisplay = endDate.toLocaleString("bs-BA", { hour: "2-digit", minute: "2-digit" });

      activities.push({
        type: "sleep",
        time: activeSleep.startIso,
        endTime: endDate.toISOString(),
        duration: durationHours,
        notes,
        startTimeDisplay: activeSleep.startDisplay,
        endTimeDisplay: endDisplay,
        timestamp: Date.now()
      });

      activeSleep = null;
      localStorage.removeItem("activeSleep");
      if (sleepInterval) { clearInterval(sleepInterval); sleepInterval = null; }

      updateSleepQuickButton(false);
      saveAndRefresh();
      closeModal("sleep");
    }

    function updateSleepQuickButton(isSleeping) {
      const el = document.getElementById("sleepLastTime");
      const r = document.getElementById("sleepRight");
      if (!el) return;

      if (isSleeping && activeSleep) {
        const elapsed = Date.now() - activeSleep.startMs;
        const hours = Math.floor(elapsed / 3600000);
        const minutes = Math.floor((elapsed % 3600000) / 60000);
        el.textContent = `Spava ${hours}h ${minutes}min`;
        if (r) r.textContent = "U toku";
      } else {
        if (r) r.textContent = "";
      }
    }

    // -----------------------------
    // FEEDING
    // -----------------------------
    function resetFeedingUI(fullReset) {
      document.getElementById("feedingInfo").style.display = "none";
      document.getElementById("feedingStartBtn").style.display = "block";
      document.getElementById("feedingEndBtn").style.display = "none";
      document.getElementById("feedingStartGroup").style.display = "block";
      document.getElementById("feedingEndGroup").style.display = "none";

      document.querySelectorAll("#breastButtons .toggle-btn").forEach(b => b.classList.remove("active"));
      selectedBreast = null;

      const chk = document.getElementById("feedingReminderCheck");
      chk.checked = false;
      document.getElementById("feedingReminderGroup").style.display = "none";
      selectedFeedingReminderHours = null;
      document.querySelectorAll("#feedingReminderGroup .toggle-btn").forEach(b => b.classList.remove("active"));

      if (fullReset) {
        document.getElementById("feedingStartTime").value = "";
        document.getElementById("feedingEndTime").value = "";
      }
    }

    function showActiveFeedingUI() {
      resetFeedingUI(false);

      selectedBreast = activeFeeding.breast;
      document.querySelectorAll("#breastButtons .toggle-btn").forEach(btn => {
        if (btn.dataset.value === activeFeeding.breast) btn.classList.add("active");
      });

      document.getElementById("feedingStartBtn").style.display = "none";
      document.getElementById("feedingEndBtn").style.display = "block";
      document.getElementById("feedingStartGroup").style.display = "none";
      document.getElementById("feedingEndGroup").style.display = "block";
      document.getElementById("feedingEndTime").value = valueForDatetimeLocalNow();

      document.getElementById("feedingInfo").style.display = "block";
      document.getElementById("feedingInfoLabel").textContent = `Poƒçeo jesti u ${activeFeeding.startDisplay}`;
    }

    function selectBreast(btn) {
      document.querySelectorAll("#breastButtons .toggle-btn").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      selectedBreast = btn.dataset.value;
    }

    function selectFeedingReminderHours(btn) {
      document.querySelectorAll("#feedingReminderGroup .toggle-btn").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      selectedFeedingReminderHours = parseFloat(btn.dataset.value);
    }

    document.getElementById("feedingReminderCheck").addEventListener("change", (e) => {
      const group = document.getElementById("feedingReminderGroup");
      if (e.target.checked) {
        group.style.display = "block";
      } else {
        group.style.display = "none";
        selectedFeedingReminderHours = null;
        document.querySelectorAll("#feedingReminderGroup .toggle-btn").forEach(b => b.classList.remove("active"));
      }
    });

    function startFeeding() {
      if (activeFeeding) return;
      if (!selectedBreast) {
        alert("Molimo odaberite dojku!");
        return;
      }

      const manual = document.getElementById("feedingStartTime").value;
      let startDate;
      if (manual) startDate = new Date(manual);
      else startDate = new Date(nowISOInTZ());

      if (startDate.getTime() > Date.now() + 60000) {
        alert("Poƒçetak hranjenja ne mo≈æe biti u buduƒánosti.");
        return;
      }

      const startIso = startDate.toISOString();
      const startDisplay = startDate.toLocaleString("bs-BA", { day: "2-digit", month: "2-digit", year: "numeric", hour: "2-digit", minute: "2-digit" });

      activeFeeding = {
        startIso,
        startMs: startDate.getTime(),
        startDisplay,
        breast: selectedBreast
      };
      localStorage.setItem("activeFeeding", JSON.stringify(activeFeeding));

      updateFeedingQuickButton(true);
      closeModal("feeding");
      ensureHomeIntervals();
      updateDisplay();
    }

    function endFeeding() {
      if (!activeFeeding) return;

      const endVal = document.getElementById("feedingEndTime").value;
      let endDate;
      if (endVal) endDate = new Date(endVal);
      else endDate = new Date(nowISOInTZ());

      const durationMin = Math.round((endDate.getTime() - activeFeeding.startMs) / 60000);
      if (durationMin <= 0) {
        alert("Gre≈°ka u vremenima!");
        return;
      }

      const notes = document.getElementById("feedingNotes").value || "";
      const endDisplay = endDate.toLocaleString("bs-BA", { day: "2-digit", month: "2-digit", year: "numeric", hour: "2-digit", minute: "2-digit" });

      activities.push({
        type: "feeding",
        time: activeFeeding.startIso,
        endTime: endDate.toISOString(),
        breast: activeFeeding.breast,
        duration: durationMin,
        notes,
        startTimeDisplay: activeFeeding.startDisplay,
        endTimeDisplay: endDisplay,
        timestamp: Date.now()
      });

      const reminderCheck = document.getElementById("feedingReminderCheck").checked;
      if (reminderCheck && selectedFeedingReminderHours) {
        const rt = new Date(endDate.getTime() + selectedFeedingReminderHours * 3600000);
        reminders.push({
          title: "Vrijeme za hranjenje",
          time: rt.toISOString(),
          description: `Pro≈°lo je ${selectedFeedingReminderHours}h od posljednjeg hranjenja`,
          timestamp: Date.now(),
          notified: false
        });
        localStorage.setItem("babyReminders", JSON.stringify(reminders));
      }

      activeFeeding = null;
      localStorage.removeItem("activeFeeding");

      updateFeedingQuickButton(false);
      saveAndRefresh();
      closeModal("feeding");
      updateReminders();
    }

    function updateFeedingQuickButton(isFeeding) {
      const el = document.getElementById("feedingLastTime");
      const r = document.getElementById("feedingRight");
      if (!el) return;

      if (isFeeding && activeFeeding) {
        const breastText = activeFeeding.breast === "left" ? "lijeva" : activeFeeding.breast === "right" ? "desna" : "obje";
        el.textContent = `Jede (${breastText}) od ${activeFeeding.startDisplay}`;
        if (r) r.textContent = "U toku";
      } else {
        if (r) r.textContent = "";
      }
    }

    // -----------------------------
    // DIAPER / BATH / MEDICINE / COLIC
    // -----------------------------
    function selectDiaperType(btn) {
      document.querySelectorAll("#diaperButtons .toggle-btn").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      selectedDiaperType = btn.dataset.value;
    }

    function saveDiaper() {
      const val = document.getElementById("diaperTime").value;
      if (!val || !selectedDiaperType) {
        alert("Molimo unesite vrijeme i odaberite tip!");
        return;
      }
      const notes = document.getElementById("diaperNotes").value || "";
      activities.push({
        type: "diaper",
        time: new Date(val).toISOString(),
        diaperType: selectedDiaperType,
        notes,
        timestamp: Date.now()
      });
      saveAndRefresh();
      closeModal("diaper");
    }

    function saveBath() {
      const val = document.getElementById("bathTime").value;
      if (!val) { alert("Molimo unesite vrijeme!"); return; }
      const temp = document.getElementById("bathTemp").value || "";
      const notes = document.getElementById("bathNotes").value || "";
      activities.push({
        type: "bath",
        time: new Date(val).toISOString(),
        temperature: temp,
        notes,
        timestamp: Date.now()
      });
      saveAndRefresh();
      closeModal("bath");
    }

    function saveMedicine() {
      const val = document.getElementById("medicineTime").value;
      const name = document.getElementById("medicineName").value.trim();
      if (!val || !name) { alert("Molimo unesite vrijeme i naziv!"); return; }
      const dose = document.getElementById("medicineDose").value || "";
      const notes = document.getElementById("medicineNotes").value || "";
      activities.push({
        type: "medicine",
        time: new Date(val).toISOString(),
        name,
        dose,
        notes,
        timestamp: Date.now()
      });
      saveAndRefresh();
      closeModal("medicine");
    }

    function selectIntensity(btn) {
      document.querySelectorAll("#intensityButtons .toggle-btn").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      selectedIntensity = btn.dataset.value;
    }

    function startColicTimer() {
      if (!selectedIntensity) {
        alert("Molimo odaberite intenzitet prije pokretanja tajmera!");
        return;
      }
      colicStartMs = Date.now();
      document.getElementById("colicTimer").style.display = "block";
      document.getElementById("colicStartBtn").style.display = "none";
      document.getElementById("colicStopBtn").style.display = "block";

      if (colicInterval) { clearInterval(colicInterval); colicInterval = null; }
      colicInterval = setInterval(() => {
        document.getElementById("colicTimerText").textContent = hmsFromMs(Date.now() - colicStartMs);
      }, 500);
    }

    function stopColicTimer() {
      if (!colicStartMs) return;
      if (colicInterval) { clearInterval(colicInterval); colicInterval = null; }
      const minutes = Math.max(1, Math.round((Date.now() - colicStartMs) / 60000));
      document.getElementById("colicDuration").value = minutes;
      document.getElementById("colicTimer").style.display = "none";
      document.getElementById("colicStartBtn").style.display = "block";
      document.getElementById("colicStopBtn").style.display = "none";
      document.getElementById("colicTimerText").textContent = "00:00:00";
      colicStartMs = null;
    }

    function saveColic() {
      const startVal = document.getElementById("colicStartTime").value;
      const durVal = document.getElementById("colicDuration").value;
      if (!startVal || !durVal || !selectedIntensity) {
        alert("Molimo popunite sva obavezna polja!");
        return;
      }
      const notes = document.getElementById("colicNotes").value || "";
      activities.push({
        type: "colic",
        time: new Date(startVal).toISOString(),
        duration: parseInt(durVal, 10),
        intensity: selectedIntensity,
        notes,
        timestamp: Date.now()
      });
      saveAndRefresh();
      closeModal("colic");
    }

    // -----------------------------
    // CHECKUP / REMINDER
    // -----------------------------
    function saveCheckup() {
      const val = document.getElementById("checkupTime").value;
      if (!val) { alert("Molimo unesite datum kontrole!"); return; }

      const doctor = document.getElementById("checkupDoctor").value || "";
      const weight = document.getElementById("checkupWeight").value;
      const height = document.getElementById("checkupHeight").value;
      const notes = document.getElementById("checkupNotes").value || "";

      checkups.push({
        time: new Date(val).toISOString(),
        doctor,
        weight: weight ? Number(weight) : null,
        height: height ? Number(height) : null,
        notes,
        timestamp: Date.now()
      });

      localStorage.setItem("babyCheckups", JSON.stringify(checkups));
      updateCheckups();
      closeModal("checkup");
    }

    function saveReminder() {
      const title = document.getElementById("reminderTitle").value.trim();
      const val = document.getElementById("reminderTime").value;
      if (!title || !val) { alert("Molimo unesite naslov i vrijeme!"); return; }
      const desc = document.getElementById("reminderDesc").value || "";

      reminders.push({
        title,
        time: new Date(val).toISOString(),
        description: desc,
        timestamp: Date.now(),
        notified: false
      });

      localStorage.setItem("babyReminders", JSON.stringify(reminders));
      updateReminders();
      closeModal("reminder");
    }

    function deleteReminder(index) {
      if (!confirm("Obrisati podsjetnik?")) return;
      reminders.splice(index, 1);
      localStorage.setItem("babyReminders", JSON.stringify(reminders));
      updateReminders();
    }

    // -----------------------------
    // PRIKAZ / STATISTIKA
    // -----------------------------
    function getActivityIcon(activity) {
      const icons = {
        sleep: { emoji: "üò¥", bg: "rgba(192, 132, 252, 0.18)", color: "rgba(168,85,247,1)" },
        feeding: { emoji: "üçº", bg: "rgba(236, 72, 153, 0.16)", color: "rgba(219,39,119,1)" },
        diaper: { emoji: "üë∂", bg: "rgba(96, 165, 250, 0.16)", color: "rgba(59,130,246,1)" },
        bath: { emoji: "üõÅ", bg: "rgba(33, 128, 141, 0.14)", color: "rgba(33,128,141,1)" },
        medicine: { emoji: "üíä", bg: "rgba(251, 146, 60, 0.14)", color: "rgba(249,115,22,1)" },
        colic: { emoji: "üò£", bg: "rgba(251, 146, 60, 0.14)", color: "rgba(249,115,22,1)" }
      };
      return icons[activity.type] || icons.sleep;
    }

    function getActivityTitle(activity) {
      const titles = {
        sleep: "San",
        feeding: "Hranjenje",
        diaper: "Pelena",
        bath: "Kupanje",
        medicine: "Lijek",
        colic: "Grƒçevi"
      };
      return titles[activity.type] || "Aktivnost";
    }

    function getActivityDetails(activity) {
      switch (activity.type) {
        case "sleep":
          return `${(activity.duration || 0).toFixed(1)}h (${activity.startTimeDisplay || "-"} - ${activity.endTimeDisplay || "-"})` +
            (activity.notes ? ` ‚Ä¢ ${escapeHtml(activity.notes)}` : "");
        case "feeding": {
          const breastText = activity.breast === "left" ? "lijeva" : activity.breast === "right" ? "desna" : "obje";
          return `${activity.duration || 0} min (${breastText})` + (activity.notes ? ` ‚Ä¢ ${escapeHtml(activity.notes)}` : "");
        }
        case "diaper": {
          const typeText = activity.diaperType === "wet" ? "Mokra" : activity.diaperType === "dirty" ? "Prljava" : "Oboje";
          return `${typeText}` + (activity.notes ? ` ‚Ä¢ ${escapeHtml(activity.notes)}` : "");
        }
        case "bath":
          return (activity.temperature ? `Temp: ${escapeHtml(activity.temperature)}` : "Kupanje") + (activity.notes ? ` ‚Ä¢ ${escapeHtml(activity.notes)}` : "");
        case "medicine":
          return `${escapeHtml(activity.name || "")}${activity.dose ? ` - ${escapeHtml(activity.dose)}` : ""}` + (activity.notes ? ` ‚Ä¢ ${escapeHtml(activity.notes)}` : "");
        case "colic": {
          const intensityText = activity.intensity === "mild" ? "Blago" : activity.intensity === "moderate" ? "Umjereno" : "Jako";
          return `${activity.duration || 0} min (${intensityText})` + (activity.notes ? ` ‚Ä¢ ${escapeHtml(activity.notes)}` : "");
        }
        default:
          return "";
      }
    }

    function cardHTML(a) {
      const icon = getActivityIcon(a);
      const title = getActivityTitle(a);
      const details = getActivityDetails(a);
      const time = formatTime(a.time);

      return `
        <div class="activity-item">
          <div class="activity-icon" style="background:${icon.bg}; color:${icon.color};">
            <span>${icon.emoji}</span>
          </div>
          <div class="activity-content">
            <div class="activity-title">${title}</div>
            <div class="activity-details">${details}</div>
          </div>
          <div class="activity-time">${time}</div>
        </div>
      `;
    }

    function activeCardHTML(type) {
      if (type === "sleep" && activeSleep) {
        const elapsed = Date.now() - activeSleep.startMs;
        const details = `U toku ‚Ä¢ Poƒçeo u ${activeSleep.startDisplay} ‚Ä¢ ${hmsFromMs(elapsed)}`;
        return `
          <div class="activity-item">
            <div class="activity-icon" style="background: rgba(192, 132, 252, 0.18); color: rgba(168,85,247,1);"><span>üò¥</span></div>
            <div class="activity-content">
              <div class="activity-title">San (aktivno)</div>
              <div class="activity-details">${escapeHtml(details)}</div>
            </div>
            <div class="activity-time">Sada</div>
          </div>
        `;
      }
      if (type === "feeding" && activeFeeding) {
        const breastText = activeFeeding.breast === "left" ? "lijeva" : activeFeeding.breast === "right" ? "desna" : "obje";
        const elapsed = Date.now() - activeFeeding.startMs;
        const details = `U toku ‚Ä¢ ${breastText} ‚Ä¢ Poƒçeo ${activeFeeding.startDisplay} ‚Ä¢ ${hmsFromMs(elapsed)}`;
        return `
          <div class="activity-item">
            <div class="activity-icon" style="background: rgba(236, 72, 153, 0.16); color: rgba(219,39,119,1);"><span>üçº</span></div>
            <div class="activity-content">
              <div class="activity-title">Hranjenje (aktivno)</div>
              <div class="activity-details">${escapeHtml(details)}</div>
            </div>
            <div class="activity-time">Sada</div>
          </div>
        `;
      }
      return "";
    }

    // HOME: samo trenutno + posljednje (po tipu)
    function updateHomeNow() {
      const container = document.getElementById("homeNowActivities");

      // posljednje po tipu (da bude jednostavno i pregledno)
      const lastByType = {};
      const sorted = [...activities].sort((a,b)=> (b.timestamp||0) - (a.timestamp||0));
      for (const a of sorted) {
        if (!lastByType[a.type]) lastByType[a.type] = a;
      }

      const blocks = [];

      // aktivni uvijek na vrh
      if (activeSleep) blocks.push(activeCardHTML("sleep"));
      if (activeFeeding) blocks.push(activeCardHTML("feeding"));

      // zatim posljednje po tipu (ali bez dupliranja aktivnih)
      const order = ["sleep","feeding","diaper","bath","medicine","colic"];
      order.forEach(t => {
        if ((t === "sleep" && activeSleep) || (t === "feeding" && activeFeeding)) return;
        if (lastByType[t]) blocks.push(cardHTML(lastByType[t]));
      });

      if (!blocks.length) {
        container.innerHTML = '<div class="empty-state">Nema aktivnosti</div>';
        return;
      }

      container.innerHTML = blocks.join("");
    }

    // HISTORIJA: grupisana po danu, najnovije prvo
    function updateAllActivities() {
      const container = document.getElementById("allActivities");
      const sorted = [...activities].sort((a,b) => (b.timestamp||0) - (a.timestamp||0));

      if (!sorted.length) {
        container.innerHTML = '<div class="empty-state">Nema aktivnosti</div>';
        return;
      }

      const groups = {};
      sorted.forEach(a => {
        const k = dayKey(a.time);
        if (!groups[k]) groups[k] = [];
        groups[k].push(a);
      });

      const keys = Object.keys(groups).sort((a,b)=> (a<b?1:-1)); // newest date first

      const html = keys.map(k => {
        const dayActs = groups[k];
        const title = dayLabelFromKey(k);
        return `
          <div class="day-group">
            <div class="day-header">
              <div class="day-title">${title}</div>
              <div class="day-meta">${dayActs.length} zapisa</div>
            </div>
            <div class="day-body">
              ${dayActs.map(a => cardHTML(a)).join("")}
            </div>
          </div>
        `;
      }).join("");

      container.innerHTML = html;
    }

    function updateStats() {
      const startOfToday = new Date(); startOfToday.setHours(0,0,0,0);
      const todayActs = activities.filter(a => new Date(a.time) >= startOfToday);

      document.getElementById("todaySleepCount").textContent = todayActs.filter(a => a.type === "sleep").length;
      document.getElementById("todayFeedingCount").textContent = todayActs.filter(a => a.type === "feeding").length;
      document.getElementById("todayDiaperCount").textContent = todayActs.filter(a => a.type === "diaper").length;

      const totalSleep = todayActs.filter(a => a.type === "sleep").reduce((sum,a) => sum + (Number(a.duration)||0), 0);
      document.getElementById("todayTotalSleep").textContent = `${totalSleep.toFixed(1)}h`;
    }

    function updateLastTimes() {
      const lastSleep = activities.filter(a => a.type === "sleep").sort((a,b)=> (b.timestamp||0)-(a.timestamp||0))[0];
      const lastFeeding = activities.filter(a => a.type === "feeding").sort((a,b)=> (b.timestamp||0)-(a.timestamp||0))[0];

      document.getElementById("lastSleepTime").textContent = lastSleep ? formatTimeAgo(lastSleep.time) : "-";
      document.getElementById("lastFeedingTime").textContent = lastFeeding ? formatTimeAgo(lastFeeding.time) : "-";

      if (!activeSleep) document.getElementById("sleepLastTime").textContent = lastSleep ? formatTimeAgo(lastSleep.time) : "-";
      if (!activeFeeding) document.getElementById("feedingLastTime").textContent = lastFeeding ? formatTimeAgo(lastFeeding.time) : "-";

      const lastDiaper = activities.filter(a => a.type === "diaper").sort((a,b)=> (b.timestamp||0)-(a.timestamp||0))[0];
      document.getElementById("diaperLastTime").textContent = lastDiaper ? formatTimeAgo(lastDiaper.time) : "-";

      const lastBath = activities.filter(a => a.type === "bath").sort((a,b)=> (b.timestamp||0)-(a.timestamp||0))[0];
      document.getElementById("bathLastTime").textContent = lastBath ? formatTimeAgo(lastBath.time) : "-";

      const lastMedicine = activities.filter(a => a.type === "medicine").sort((a,b)=> (b.timestamp||0)-(a.timestamp||0))[0];
      document.getElementById("medicineLastTime").textContent = lastMedicine ? formatTimeAgo(lastMedicine.time) : "-";

      const lastColic = activities.filter(a => a.type === "colic").sort((a,b)=> (b.timestamp||0)-(a.timestamp||0))[0];
      document.getElementById("colicLastTime").textContent = lastColic ? formatTimeAgo(lastColic.time) : "-";

      if (activeSleep) updateSleepQuickButton(true);
      if (activeFeeding) updateFeedingQuickButton(true);
    }

    function updateCheckups() {
      const container = document.getElementById("checkupList");
      const sorted = [...checkups].sort((a,b) => new Date(b.time) - new Date(a.time));

      if (!sorted.length) {
        container.innerHTML = '<div class="empty-state">Nema unesenih kontrola</div>';
        return;
      }

      container.innerHTML = sorted.map(ch => {
        const time = formatTime(ch.time);
        const details = [];
        if (ch.weight) details.push(`${ch.weight} kg`);
        if (ch.height) details.push(`${ch.height} cm`);
        const notes = ch.notes ? `<div class="activity-details" style="margin-top:4px;">${escapeHtml(ch.notes)}</div>` : "";

        return `
          <div class="activity-item">
            <div class="activity-icon" style="background: rgba(34,197,94,0.16); color: rgba(34,197,94,1);"><span>üè•</span></div>
            <div class="activity-content">
              <div class="activity-title">${escapeHtml(ch.doctor || "Kontrola")}</div>
              <div class="activity-details">${details.join(" ‚Ä¢ ") || "‚Äî"}</div>
              ${notes}
            </div>
            <div class="activity-time">${time}</div>
          </div>
        `;
      }).join("");
    }

    function updateReminders() {
      const container = document.getElementById("remindersList");
      const now = new Date();
      const sorted = [...reminders].sort((a,b) => new Date(a.time) - new Date(b.time));

      if (!sorted.length) {
        container.innerHTML = '<div class="empty-state">Nema podsjetnika</div>';
        document.getElementById("reminderBadge").style.display = "none";
        return;
      }

      const activeCount = sorted.filter(r => new Date(r.time) > now).length;
      const badge = document.getElementById("reminderBadge");
      if (activeCount > 0) {
        badge.textContent = activeCount;
        badge.style.display = "flex";
      } else {
        badge.style.display = "none";
      }

      container.innerHTML = sorted.map((r, idx) => {
        const t = formatTime(r.time);
        const isPast = new Date(r.time) < now;
        return `
          <div class="reminder-item" style="${isPast ? "opacity:0.65;" : ""}">
            <div class="reminder-content">
              <div class="reminder-title">${escapeHtml(r.title)}</div>
              <div class="reminder-time">${t}</div>
              ${r.description ? `<div class="reminder-time" style="margin-top:4px;">${escapeHtml(r.description)}</div>` : ""}
            </div>
            <div class="delete-btn" onclick="deleteReminder(${idx})">üóëÔ∏è</div>
          </div>
        `;
      }).join("");
    }

    function updateDisplay() {
      updateHomeNow();
      updateAllActivities();
      updateStats();
      updateLastTimes();
      updateCheckups();
      updateReminders();
    }

    function saveAndRefresh() {
      localStorage.setItem("babyActivities", JSON.stringify(activities));
      updateDisplay();
    }

    // -----------------------------
    // NAVIGACIJA
    // -----------------------------
    function switchPage(page) {
      document.querySelectorAll(".page").forEach(p => p.classList.remove("active"));
      document.querySelectorAll(".nav-item").forEach(n => n.classList.remove("active"));

      const pageEl = document.getElementById(page + "Page");
      if (pageEl) pageEl.classList.add("active");

      const nav = document.querySelector(`.nav-item[data-page="${page}"]`);
      if (nav) nav.classList.add("active");

      // kad uƒëe u historiju, osvje≈æi da sticky day-header radi fino
      if (page === "history") updateAllActivities();
    }

    // -----------------------------
    // NOTIFIKACIJE PODSJETNIKA
    // -----------------------------
    function requestNotificationPermission() {
      if ("Notification" in window && Notification.permission === "default") {
        Notification.requestPermission();
      }
    }

    function showReminderNotification(reminder) {
      const msg = `${reminder.title}\n${reminder.description || ""}`.trim();

      if (!("Notification" in window)) {
        alert("Podsjetnik:\n\n" + msg);
        return;
      }

      if (Notification.permission === "granted") {
        const n = new Notification("Nori Tracker", { body: msg });
        n.onclick = () => { window.focus(); switchPage("reminders"); n.close(); };
        return;
      }

      alert("Podsjetnik:\n\n" + msg);
    }

    function checkDueReminders() {
      const now = new Date();
      let changed = false;

      reminders.forEach(r => {
        const rt = new Date(r.time);
        const diff = rt.getTime() - now.getTime();
        if (diff <= 0) return;
        if (diff < 60000 && !r.notified) {
          showReminderNotification(r);
          r.notified = true;
          changed = true;
        }
      });

      if (changed) {
        localStorage.setItem("babyReminders", JSON.stringify(reminders));
        updateReminders();
      }
    }

    // -----------------------------
    // HOME INTERVALI
    // -----------------------------
    let homeInterval = null;

    function ensureHomeIntervals() {
      if (homeInterval) return;
      homeInterval = setInterval(() => {
        if (activeSleep) updateSleepQuickButton(true);
        if (activeFeeding) updateFeedingQuickButton(true);
        updateLastTimes();
        updateHomeNow();
        checkDueReminders();
      }, 1000);
    }

    // -----------------------------
    // INIT
    // -----------------------------
    if (activeSleep) updateSleepQuickButton(true);
    if (activeFeeding) updateFeedingQuickButton(true);

    updateDisplay();
    requestNotificationPermission();
    ensureHomeIntervals();

    setInterval(updateReminders, 30000);
  </script>
</body>
</html>
